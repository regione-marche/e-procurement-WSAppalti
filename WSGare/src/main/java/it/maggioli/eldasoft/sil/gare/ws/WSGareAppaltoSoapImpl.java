/**
 * Please modify this class to meet your needs
 * This class is not complete
 */
package it.maggioli.eldasoft.sil.gare.ws;

import it.eldasoft.sil.portgare.datatypes.DatiImpresaDocument;
import it.eldasoft.utils.sql.comp.SqlComposerException;
import it.eldasoft.utils.utility.UtilityDate;
import it.maggioli.eldasoft.gene.bl.DatiCodificatiManager;
import it.maggioli.eldasoft.gene.ws.WSOperazioniGeneraliSoapImpl;
import it.maggioli.eldasoft.sil.gare.bl.AvvisiManager;
import it.maggioli.eldasoft.sil.gare.bl.BandiManager;
import it.maggioli.eldasoft.sil.gare.bl.CataloghiManager;
import it.maggioli.eldasoft.sil.gare.bl.ContrattiManager;
import it.maggioli.eldasoft.sil.gare.bl.EsitiManager;
import it.maggioli.eldasoft.sil.gare.bl.ImpreseManager;
import it.maggioli.eldasoft.sil.gare.db.vo.AttributoAggiuntivoOfferta;
import it.maggioli.eldasoft.sil.gare.db.vo.ComunicazioneLotto;
import it.maggioli.eldasoft.sil.gare.db.vo.CriterioValutazioneOffertaLotto;
import it.maggioli.eldasoft.sil.gare.db.vo.DocumentazioneRichiestaLotto;
import it.maggioli.eldasoft.sil.gare.db.vo.DocumentoAllegatoLotto;
import it.maggioli.eldasoft.sil.gare.db.vo.RequisitoRichiestoLotto;
import it.maggioli.eldasoft.sil.gare.db.vo.SoggettoAderenteLotto;
import it.maggioli.eldasoft.sil.gare.ws.search.AvvisiTypeSearch;
import it.maggioli.eldasoft.sil.gare.ws.search.EsitoTypeSearch;
import it.maggioli.eldasoft.sil.gare.ws.search.GaraTypeSearch;
import it.maggioli.eldasoft.wsOperazioniGenerali.daticomuni.DatoCodificatoType;
import org.apache.commons.lang.StringUtils;
import org.apache.xmlbeans.XmlError;
import org.apache.xmlbeans.XmlObject;
import org.apache.xmlbeans.XmlOptions;
import org.apache.xmlbeans.XmlValidationError;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataAccessException;
import org.springframework.stereotype.Service;

import javax.jws.WebService;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.List;

/**
 * This class was generated by Apache CXF 2.7.18
 * 2016-09-01T16:31:15.037+02:00
 * Generated source version: 2.7.18
 * 
 */

@Service
@WebService(
      serviceName = "WSGareAppaltoSoap",
      portName = "WSGareAppaltoSOAP",
      targetNamespace = "http://www.eldasoft.it/sil/WSGareAppalto/",
      endpointInterface = "it.maggioli.eldasoft.sil.gare.ws.WSGareAppaltoSoap"
)                      
public class WSGareAppaltoSoapImpl implements WSGareAppaltoSoap {

	private static final Logger LOG = LoggerFactory.getLogger(WSGareAppaltoSoapImpl.class);

	/**
	 * Tipologie di busta 
	 */
	public static final String BUSTA_AMMINISTRATIVA = "1";
	public static final String BUSTA_TECNICA 		= "2";
	public static final String BUSTA_ECONOMICA 		= "3";
	public static final String BUSTA_PRE_QUALIFICA 	= "4";

	@Autowired
	private DatiCodificatiManager datiCodificatiManager;
	@Autowired
	private BandiManager bandiManager;
	@Autowired
	private EsitiManager esitiManager;
	@Autowired
	private AvvisiManager avvisiManager;
	@Autowired
	private ImpreseManager impreseGaraManager;
	@Autowired
	private CataloghiManager cataloghiManager;
	@Autowired
	private ContrattiManager contrattiManager;
	
	@Override
	public it.maggioli.eldasoft.sil.gare.ws.VersionOutType getVersion() throws DataAccessException {
		LOG.debug("getVersion(): inizio metodo");

		VersionOutType risultato = new VersionOutType();
		try {
			String[] path = this.getClass().getClassLoader().getResource("").getPath().split("/WEB-INF/classes");
			String appPath = (path != null ? path[0] : "");
			appPath = appPath.replaceAll("%20", "\\ ");
			
		    BufferedReader br = new BufferedReader(new FileReader(new File(appPath + "/WEB-INF/WSPG_VER.TXT")));
		    String version = "";
	        String s;
	        while((s = br.readLine()) != null) {
	        	if(s != null) {
	        		version += s + "\n";
	        	}
	        }	
			risultato.setVersion(version);
		} catch (Exception e) {
			LOG.error(
					"Errore inaspettato durante l'interazione con la base dati",
					e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getVersion: fine metodo");
		return risultato;
	}

	@Override
	public it.maggioli.eldasoft.sil.gare.ws.VersionOutType getAppaltiVersion() throws DataAccessException {
		LOG.debug("getAppaltiVersion(): inizio metodo");

		VersionOutType risultato = new VersionOutType();
		try {
			String version = this.bandiManager.getAppaltiVersion();
			risultato.setVersion(version);
		} catch (Exception e) {
			LOG.error(
					"Errore inaspettato durante l'interazione con la base dati",
					e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getAppaltiVersion: fine metodo");
		return risultato;
	}

	@Override
	public ElencoBandiOutType searchBandi(GaraTypeSearch filtri) {
		LOG.debug("searchBandi({},{},{},{},{},{},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig(), filtri.getTipoAppalto()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getProceduraTelematica(), filtri.getStato()
			, filtri.getNumAnniPubblicazione(), filtri.getAltriSoggetti(), filtri.getSommaUrgenza()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();

		try {
			int count = bandiManager.countBandi(filtri);
			
			List<GaraType> listaGare = bandiManager.searchBandi(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("searchBandi: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType getElencoBandi(GaraTypeSearch filtri) {
		LOG.debug("elencoBandi({},{},{},{},{},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig(), filtri.getTipoAppalto()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getProceduraTelematica(), filtri.getStato(), filtri.getAltriSoggetti()
			, filtri.getSommaUrgenza()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();

		try {
			int count = bandiManager.countElencoBandi(filtri);
			
			List<GaraType> listaGare = bandiManager.getElencoBandi(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandi: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType getElencoBandiPrivatistiche(GaraTypeSearch filtri) {
		LOG.debug("elencoBandiPrivatistiche({},{},{},{},{},{};{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig(), filtri.getTipoAppalto()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getProceduraTelematica(), filtri.getStato(), filtri.getAltriSoggetti()
			, filtri.getSommaUrgenza(), filtri.getGaraPrivatistica()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();

		try {
			int count = this.bandiManager.countElencoBandi(filtri);
			
			List<GaraType> listaGare = this.bandiManager.getElencoBandi(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandiPrivatistiche: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType getElencoBandiScaduti(GaraTypeSearch filtri) {
		LOG.debug("elencoBandiScaduti({};{},{},{},{},{},{},{},{},{},{};{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig(), filtri.getTipoAppalto()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getProceduraTelematica(), filtri.getStato(), filtri.getEsito()
			, filtri.getAltriSoggetti(), filtri.getSommaUrgenza(), filtri.getVisualizzaNegoziate()
			, filtri.getNumAnniPubblicazione()
		);
		ElencoBandiOutType risultato = new ElencoBandiOutType();

		try {
			int count = bandiManager.countElencoBandiScaduti(filtri);

			List<GaraType> listaGare = bandiManager.getElencoBandiScaduti(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandiScaduti: fine metodo");

		return risultato;
	}
	
	@Override
	public ElencoBandiOutType getElencoBandiScadutiPrivatistiche(GaraTypeSearch filtri) {
		LOG.debug("elencoBandiScadutiPrivatistiche({},{},{},{},{},{},{},{},{},{},{},{},{},{},{}):inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig(), filtri.getTipoAppalto()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getProceduraTelematica(), filtri.getStato(), filtri.getEsito()
			, filtri.getAltriSoggetti(), filtri.getSommaUrgenza(), filtri.getGaraPrivatistica()
			, filtri.getNumAnniPubblicazione()
		);
		ElencoBandiOutType risultato = new ElencoBandiOutType();

		try {
			filtri.setVisualizzaNegoziate(null);
			int count = bandiManager.countElencoBandiScaduti(filtri);

			List<GaraType> listaGare = bandiManager.getElencoBandiScaduti(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandiScadutiPrivatistiche: fine metodo");

		return risultato;
	}

	@Override
	public RisultatoStringaOutType getCigBando(String codiceGara) {
		LOG.debug("getCigBando(" + codiceGara + "): inizio metodo");
		RisultatoStringaOutType risultato = new RisultatoStringaOutType();
		try {
			String cig = this.bandiManager.getCigBando(codiceGara);
			risultato.setValore(cig);
		} catch (DataAccessException e) {
			LOG.error(
					"Errore inaspettato durante l'interazione con la base dati",
					e);
			risultato.setErrore(e.getMessage());
		}

		
		LOG.debug("getCigBando: fine metodo");
		return risultato;
	}

	@Override
	public DettaglioGaraOutType getDettaglioGara(String codiceGara) {
		LOG.debug("dettaglioGara(" + codiceGara + "): inizio metodo");

		DettaglioGaraOutType risultato = new DettaglioGaraOutType();

		try {
			DettaglioGaraType gara =  null; 
			GaraType datiGeneraliGara = this.bandiManager.getBando(codiceGara);
			if (datiGeneraliGara != null) {
				gara = new DettaglioGaraType();

				// ottimizzazione su v_ws_dettaglio_bando
				//StazioneAppaltanteBandoType stazioneAppaltante = this.bandiManager
				//	.getStazioneAppaltanteBando(codiceGara);
				StazioneAppaltanteBandoType stazioneAppaltante = new StazioneAppaltanteBandoType();
				stazioneAppaltante.codice = datiGeneraliGara.getSACodice();
				stazioneAppaltante.denominazione = datiGeneraliGara.getSADescrizione();
				stazioneAppaltante.rup = datiGeneraliGara.getSARup();
				stazioneAppaltante.puntoOrdinante = this.bandiManager.getPuntiOrdinanti(codiceGara);
				stazioneAppaltante.puntoIstruttore = this.bandiManager.getPuntiIstruttori(codiceGara);
				
				String codiceStazioneAppaltante = (stazioneAppaltante != null ? stazioneAppaltante.getCodice() : null);		
				
//				List<String> istruttori = this.bandiManager.getPuntiIstruttori(codiceGara);				
				List<DocumentoAllegatoType> documenti = this.bandiManager
					.getDocumentiBandoLotto(codiceGara, null);
				List<DocumentoAllegatoType> inviti = this.bandiManager
					.getDocumentiInvitoLotto(codiceGara, null);
				List<RequisitoRichiestoType> requisitiRichiesti = this.bandiManager
					.getRequisitiRichiestiBandoLotto(codiceGara, null);				
				List<SoggettoAderenteType> soggettiAderenti = this.bandiManager
					.getSoggettiAderenti(codiceGara);

				// la busta di prequalifica va recuperata solo in caso di 
				// gara ristretta. "iterGara" può assumere i valori:				
				//   APERTA    = { 1 }        
				//   RISTRETTA = { 2, 4 }     
				//   NEGOZIATA = { 3, 5, 6 }  
				boolean garaRistretta = ("2".equals(datiGeneraliGara.getIterGara()) ||
									     "4".equals(datiGeneraliGara.getIterGara()));
				
				List<DocumentazioneRichiestaType> documentiBustaPreQualifica = null;
				if(garaRistretta) {
					documentiBustaPreQualifica = this.bandiManager
							.getDocumentiRichiestiBandoGara(codiceGara, null, null, false,
									BUSTA_PRE_QUALIFICA);
				}
				List<DocumentazioneRichiestaType> documentiBustaAmministrativa = this.bandiManager
						.getDocumentiRichiestiBandoGara(codiceGara, null,  null, false,
								BUSTA_AMMINISTRATIVA);
				List<DocumentazioneRichiestaType> documentiBustaTecnica = this.bandiManager
						.getDocumentiRichiestiBandoGara(codiceGara, null,  null, false,
								BUSTA_TECNICA);
				List<DocumentazioneRichiestaType> documentiBustaEconomica = this.bandiManager
						.getDocumentiRichiestiBandoGara(codiceGara, null,  null, false,
								BUSTA_ECONOMICA);

				List<CriterioValutazioneOffertaType> criteriValutazione = this.bandiManager
					.getCriteriValutazioneOfferta(codiceGara, null);
		
				List<ComunicazioneType> comunicazioni = this.bandiManager
						.getComunicazioniPubbliche(codiceGara, null, null);

				// per ogni lotto recupera anche tutti i documenti associati...
				List<DocumentoAllegatoLotto> lotti = this.bandiManager
					.getDocumentiGara(codiceGara);

				gara.setStazioneAppaltante(stazioneAppaltante);
				gara.setDatiGeneraliGara(datiGeneraliGara);
				gara.setDocumento(documenti);
				gara.setInvito(inviti);
				gara.setRequisitoRichiesto(requisitiRichiesti);
				gara.setDocumentoBustaPreQualifica(documentiBustaPreQualifica);
				gara.setDocumentoBustaAmministrativa(documentiBustaAmministrativa);
				gara.setDocumentoBustaTecnica(documentiBustaTecnica);
				gara.setDocumentoBustaEconomica(documentiBustaEconomica);
				gara.setListaCriteriValutazione(criteriValutazione);
				gara.setComunicazione(comunicazioni);
				// gara.setChiarimento(chiarimenti);
				gara.setSoggettiAderenti(soggettiAderenti);

				// ciclo sui lotti per estrarre documenti requisiti e comunicazioni
				// specifiche di ogni singolo lotto
				List<LottoDettaglioGaraType> lottiGara = new ArrayList<LottoDettaglioGaraType>();
				LottoDettaglioGaraType lotto = null;
				List<DocumentoAllegatoType> documentiLotto = null;
				List<DocumentoAllegatoType> invitiLotto = null;
				List<RequisitoRichiestoType> requisitiRichiestiLotto = null;
				List<DocumentazioneRichiestaType> documentiBustaPreQualificaLotto = null;
				List<DocumentazioneRichiestaType> documentiBustaAmministrativaLotto = null;
				List<DocumentazioneRichiestaType> documentiBustaTecnicaLotto = null;
				List<DocumentazioneRichiestaType> documentiBustaEconomicaLotto = null;
				List<CriterioValutazioneOffertaLotto> criteriValutazioneLotto = null;
				List<ComunicazioneType> comunicazioniLotto = null;
				int garaCostoFisso = 1;
				
				// per ogni lotto recupera tutte le buste, i requisiti richiesti,
				// i soggetti aderenti e le comunicazioni, in un'unica query
				// e ripartisci nel lotto corretto, ogni oggetto nella struttura 
				// relativa 
				List<DocumentazioneRichiestaLotto> lottiDocumentiBusta = this.bandiManager
					.getDocumentiRichiestiBando(codiceGara, null, false);

				List<RequisitoRichiestoLotto> lottiRequisitiRichiesti = this.bandiManager
					.getRequisitiRichiestiBando(codiceGara);
				
				List<SoggettoAderenteLotto> lottiSoggettiAderenti = this.bandiManager
					.getLottiSoggettiAderenti(codiceGara);
		
				List<ComunicazioneLotto> lottiComunicazioni = this.bandiManager
					.getLottiComunicazioniPubbliche(codiceGara, null, codiceStazioneAppaltante);
				
				List<CriterioValutazioneOffertaLotto> lottiCriteriValutazione = this.bandiManager
					.getCriteriValutazioneOffertaLotti(codiceGara, null);

				for (int i = 0; i < lotti.size(); i++) {
					// l'elenco delle coppie (lotto, documento) e' ordinato per
					// codice lotto... 
					// per ogni coppia (lotto, documento) verifica se il lotto 
					// in esame e' cambiato rispetto all'ultimo utilizzato
					// ed eventualmente crea un nuovo lotto nel quale inserire 
					// buste, requisiti, soggeti e comunizazioni...
					boolean nuovoLotto = false;
					if( (lotto == null) ||
						(lotto != null && !lotti.get(i).getCodiceLotto().equalsIgnoreCase(lotto.getCodiceLotto())) ){
						// crea ed aggiungi il nuovo lotto...
						lotto = new LottoDettaglioGaraType();
						lotto.setCodiceLotto(lotti.get(i).getCodiceLotto());
						lotto.setCodiceInterno(lotti.get(i).getCodiceInterno());
						lotto.setOggetto(lotti.get(i).getOggetto());
						lotto.setCostoFisso(lotti.get(i).getCostoFisso());
						lottiGara.add(lotto);
						nuovoLotto = true;
					}
					
					
					// ...per il lotto corrente aggiungi i documenti normali (gruppo=1)
					// ed i documenti di invito (gruppo=6) 
					// ai documenti dell'elenco dei documenti del lotto corrente... 
					documentiLotto = lotto.getDocumento();
					invitiLotto = lotto.getInvito();
					
					if( "6".equals(lotti.get(i).getGruppo()) ) {
						// documenti di invito (gruppo=6)
						if(invitiLotto == null) {
							invitiLotto = new ArrayList<DocumentoAllegatoType>();
						}
						invitiLotto.add(lotti.get(i));
					} else if( "1".equals(lotti.get(i).getGruppo()) ) {
						// documenti normali (gruppo=1)
						if(documentiLotto == null) {
							documentiLotto = new ArrayList<DocumentoAllegatoType>();
						}
						documentiLotto.add(lotti.get(i));
					}
					
					lotto.setDocumento(documentiLotto);
					lotto.setInvito(invitiLotto);
					
					// per ogni nuovo lotto aggiorna i dati delle strutture 
					// - requisiti richiesti
					// - soggetti aderenti
					// - buste (prequalifica, amministrativa, tecnica, economica) 
					// - comunicazioni
					if(nuovoLotto) {
						
						// requisiti rischiesti
						// estrai dalla query con tutte le coppie (lotto, requisito)
						// i requisiti richiesti da aggiungere al lotto corrente
						requisitiRichiestiLotto = lotto.getRequisitoRichiesto();
						if(lottiRequisitiRichiesti != null) {
							for(int j = 0; j < lottiRequisitiRichiesti.size(); j++) {
								if( lotti.get(i).getCodiceLotto().equalsIgnoreCase(lottiRequisitiRichiesti.get(j).getCodiceLotto()) ) {
									if(requisitiRichiestiLotto == null) {
										requisitiRichiestiLotto = new ArrayList<RequisitoRichiestoType>();
									}
									requisitiRichiestiLotto.add(lottiRequisitiRichiesti.get(j));
								}
							}
						}
						lotto.setRequisitoRichiesto(requisitiRichiestiLotto);
					
						// soggetti aderenti
						// estrai dalla query con tutte le coppie (lotto, soggetto)
						// i soggetti aderenti da aggiungere al lotto corrente
						soggettiAderenti = lotto.getSoggettiAderenti();
						if(lottiSoggettiAderenti != null) {
							for(int j = 0; j < lottiSoggettiAderenti.size(); j++) {
								if( lotti.get(i).getCodiceLotto().equalsIgnoreCase(lottiSoggettiAderenti.get(j).getCodiceLotto()) ) {
									if(soggettiAderenti == null) {
										soggettiAderenti = new ArrayList<SoggettoAderenteType>();
									}
									soggettiAderenti.add(lottiSoggettiAderenti.get(j));
								}
							}
						}
						lotto.setSoggettiAderenti(soggettiAderenti);
					
						// buste prequalifica, amministrativa, tecnica, economica
						// estrai dalla query con tutte le coppie (lotto, documento busta)
						// i documenti delle buste da aggiungere al lotto corrente
						documentiBustaPreQualificaLotto = null;
						documentiBustaAmministrativaLotto = null;
						documentiBustaTecnicaLotto = null;
						documentiBustaEconomicaLotto = null;
						for(int j = 0; j < lottiDocumentiBusta.size(); j++) {
							if( lotti.get(i).getCodiceLotto().equalsIgnoreCase(lottiDocumentiBusta.get(j).getCodiceLotto()) ) {
								
								// se un documento non ha un tipo busta allora
								// significa che e' un documento da inserire 
								// in tutte le buste 
								boolean docPerOgniBusta = (lottiDocumentiBusta.get(j).getTipoBusta() == null);
								
								// la busta di prequalifica va recuperata solo in caso di gara ristretta...
								if(garaRistretta) {
									if(docPerOgniBusta || BUSTA_PRE_QUALIFICA.equals(lottiDocumentiBusta.get(j).getTipoBusta())) {
										if(documentiBustaPreQualificaLotto == null) {
											documentiBustaPreQualificaLotto = new ArrayList<DocumentazioneRichiestaType>();
										} 
										documentiBustaPreQualificaLotto.add(lottiDocumentiBusta.get(j));
									}
								} 
								if(docPerOgniBusta || BUSTA_AMMINISTRATIVA.equals(lottiDocumentiBusta.get(j).getTipoBusta())) {
									if(documentiBustaAmministrativaLotto == null) {
										documentiBustaAmministrativaLotto = new ArrayList<DocumentazioneRichiestaType>();
									} 
									documentiBustaAmministrativaLotto.add(lottiDocumentiBusta.get(j));
								} 
								if(docPerOgniBusta || BUSTA_TECNICA.equals(lottiDocumentiBusta.get(j).getTipoBusta())) {
									if(documentiBustaTecnicaLotto == null) {
										documentiBustaTecnicaLotto = new ArrayList<DocumentazioneRichiestaType>();
									} 
									documentiBustaTecnicaLotto.add(lottiDocumentiBusta.get(j));
								} 
								if(docPerOgniBusta || BUSTA_ECONOMICA.equals(lottiDocumentiBusta.get(j).getTipoBusta())) {
									if(documentiBustaEconomicaLotto == null) {
										documentiBustaEconomicaLotto = new ArrayList<DocumentazioneRichiestaType>();
									} 
									documentiBustaEconomicaLotto.add(lottiDocumentiBusta.get(j));
								}
							}
						}
						lotto.setDocumentoBustaPreQualifica(documentiBustaPreQualificaLotto);
						lotto.setDocumentoBustaAmministrativa(documentiBustaAmministrativaLotto);
						lotto.setDocumentoBustaTecnica(documentiBustaTecnicaLotto);
						lotto.setDocumentoBustaEconomica(documentiBustaEconomicaLotto);

						// criteri di valutazione OEPV
						criteriValutazioneLotto = null;
						if(lottiCriteriValutazione != null) {
							for(int j = 0; j < lottiCriteriValutazione.size(); j++) {
								if( lotti.get(i).getCodiceLotto().equalsIgnoreCase(lottiCriteriValutazione.get(j).getCodiceLotto()) ) {
									if(criteriValutazioneLotto == null) {
										criteriValutazioneLotto = new ArrayList<CriterioValutazioneOffertaLotto>();
									}
									criteriValutazioneLotto.add(lottiCriteriValutazione.get(i));
								}
							}
						}
						criteriValutazione = bandiManager.getCriteriValutazioneOfferta(lotto.getCodiceLotto(), null);
						
						lotto.setListaCriteriValutazione(criteriValutazione);
						
						// comunicazioni
						// estrai dalla query con tutte le coppie (lotto, comunicazione)
						// le comunicazioni da aggiungere al lotto corrente
						if (!codiceGara.equals(lotto.getCodiceLotto())) {
							// va evitato il caso di gara a lotto unico, in quanto in
							// tale caso gara e lotto hanno lo stesso id, e le
							// comunicazioni estratte per la gara verrebbero riestratte
							// anche per il lotto creando degli inutili duplicati
							comunicazioniLotto = lotto.getComunicazione();
							for(int j = 0; j < lottiComunicazioni.size(); j++) {
								if( lotti.get(i).getCodiceLotto().equalsIgnoreCase(lottiComunicazioni.get(j).getCodiceLotto()) ) {
									if(comunicazioniLotto == null) {
										comunicazioniLotto = new ArrayList<ComunicazioneType>();
									} 
									comunicazioniLotto.add(lottiComunicazioni.get(j));
								}
							}
							lotto.setComunicazione(comunicazioniLotto);
						}
					
						// gara plico unico offerta unica con lotti...
						// se tutti i lotti sono a costofisso allora anche la gara
						// deve essere a costo fisso...
						if(i > 0) {
							int costofisso = (lotti.get(i).getCostoFisso() != null 
											  ? lotti.get(i).getCostoFisso() : 0); 
							if(costofisso != 1) {
								garaCostoFisso = 0;
							}
						}
					}
				}
				gara.setLotto(lottiGara);

				// gara plico unico offerta unica con lotti...
				// se tutti i lotti sono a costofisso allora anche la gara
				// deve essere a costo fisso...
				if(lottiGara != null && lottiGara.size() > 1) {
					gara.getDatiGeneraliGara().setCostoFisso(garaCostoFisso);
				}

				// verifica se per la gara è presente un'asta elettronica 
				// e se l'asta è attiva 
				try {
					datiGeneraliGara.setInvitataAsta(false);
					
					datiGeneraliGara.setAstaElettronica( 
							this.bandiManager.isAstaElettronica(codiceGara));
				
					datiGeneraliGara.setAstaAttiva(
							this.bandiManager.isAstaAttiva(codiceGara, new Date()));
					
					datiGeneraliGara.setDataInizioAsta(
							this.bandiManager.getDataInizioAsta(codiceGara));
					
					datiGeneraliGara.setDataInvitoAsta(
							this.bandiManager.getDataInvitoAsta(codiceGara));
				} catch(Exception e) {
					LOG.error(
							"Impossibile leggere lo stato dell'asta elettronica",
							e);
				}
				datiGeneraliGara.setRettifichePresentazioneDomanda( bandiManager.getRettifichePresentazioneDomanda(codiceGara) );
				datiGeneraliGara.setRettifichePresentazioneOfferta(bandiManager.getRettifichePresentazioneOfferta(codiceGara)) ;
				
			}
			
			// aggiungo le informaizoni relative a 
			// rettifichePresentazioneDomanda e rettifichePresentazioneOfferta
			
			
			risultato.setGara(gara);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("dettaglioGara: fine metodo");

		return risultato;
	}

	@Override
	public DettaglioGaraOutType getDettaglioGaraFromLotto(String codiceLotto) {
		LOG.debug("dettaglioGaraFromLotto(" + codiceLotto
				+ "): inizio metodo");

		DettaglioGaraOutType risultato = new DettaglioGaraOutType();

		try {
			String codiceGara = this.bandiManager
					.getCodiceGaraFromCodiceLotto(codiceLotto);
			if (codiceGara != null) {
				risultato = this.getDettaglioGara(codiceGara);
			} else {
				risultato.setErrore("Impossibile identificare la gara dal codice lotto " + codiceLotto);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("dettaglioGaraFromLotto: fine metodo");

		return risultato;
	}

	@Override
	public EsitoOutType isGaraConOffertaTecnica(String codiceGara) {
		LOG.debug("isGaraConOffertaTecnica(" + codiceGara + "): inizio metodo");

		EsitoOutType risultato = new EsitoOutType();
		try {
			Boolean esito = this.bandiManager.isGaraConOffertaTecnica(codiceGara);
			risultato.setEsito(esito);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("isGaraConOffertaTecnica: fine metodo");
		return risultato;

	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoStazioniAppaltanti()
	 */
	@Override
	public String getElencoStazioniAppaltanti() {
		LOG.debug("elencoStazioniAppaltanti: inizio metodo");

		List<DatoCodificatoType> lista = this.bandiManager
				.getElencoStazioniAppaltanti();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoStazioniAppaltanti: fine metodo");

		return documentoXML;
	}
	
	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoStazioniAppaltantiL190()
	 */
	@Override
	public String getElencoStazioniAppaltantiL190() {
		LOG.debug("elencoStazioniAppaltanti: inizio metodo");

		List<DatoCodificatoType> lista = this.bandiManager
				.getElencoStazioniAppaltantiL190();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoStazioniAppaltanti: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiAppalto()
	 */
	@Override
	public String getElencoTipiAppalto() {
		LOG.debug("elencoTipiAppalto: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A1007");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiAppalto: fine metodo");
		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiAppaltoCategorie()
	 */
	@Override
	public String getElencoTipiAppaltoCategorie() {
		LOG.debug("elencoTipiAppaltoCategorie: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_038");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiAppaltoCategorie: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiProcedura()
	 */
	@Override
	public String getElencoTipiProcedura() {
		LOG.debug("elencoTipiProcedura: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A2044");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiProcedura: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiAggiudicazione()
	 */
	@Override
	public String getElencoTipiAggiudicazione() {
		LOG.debug("elencoTipiAggiudicazione: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A2081");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiAggiudicazione: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoStatiGara()
	 */
	@Override
	public String getElencoStatiGara() {
		LOG.debug("elencoStatiGara: inizio metodo");

		List<DatoCodificatoType> lista = this.bandiManager.getStatiGara();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoStatiGara: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoStazioniAppaltanti()
	 */
	@Override
	public String getElencoEsitiGara() {
		LOG.debug("getElencoEsitiGara: inizio metodo");

		List<DatoCodificatoType> lista = this.bandiManager.getEsitiGara();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("getElencoEsitiGara: fine metodo");

		return documentoXML;
	}
	
	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoClassificazioniLavori()
	 */
	@Override
	public String getElencoClassificazioniLavori() {
		LOG.debug("elencoClassificazioniLavori: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A1015");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoClassificazioniLavori: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoClassificazioniLavoriPerIscrizione()
	 */
	@Override
	public String getElencoClassificazioniLavoriPerIscrizione() {
		LOG.debug("elencoClassificazioniLavoriPerIscrizione: inizio metodo");

		List<DatoCodificatoType> lista = this.bandiManager
				.getElencoClassificazioniLavoriPerIscrizione();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoClassificazioniLavoriPerIscrizione: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoClassificazioniLavoriSottoSoglia()
	 */
	@Override
	public String getElencoClassificazioniLavoriSottoSoglia() {
		LOG.debug("elencoClassificazioniLavoriSottoSoglia: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_037");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoClassificazioniLavoriSottoSoglia: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoClassificazioniForniture()
	 */
	@Override
	public String getElencoClassificazioniForniture() {
		LOG.debug("elencoClassificazioniForniture: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_035");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoClassificazioniForniture: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoClassificazioniServizi()
	 */
	@Override
	public String getElencoClassificazioniServizi() {
		LOG.debug("elencoClassificazioniServizi: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_036");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoClassificazioniServizi: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoClassificazioniServiziProfessionali()
	 */
	@Override
	public String getElencoClassificazioniServiziProfessionali() {
		LOG.debug("elencoClassificazioniServiziProfessionali: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_049");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoClassificazioniServiziProfessionali: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiAvviso()
	 */
	@Override
	public String getElencoTipiAvviso() {
		LOG.debug("elencoTipiAvviso: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A1081");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiAvviso: fine metodo");

		return documentoXML;
	}

	@Override
	public LottiEsitoOutType getLottiEsito(String codiceGara) {
		LOG.debug("lottiEsito(" + codiceGara + "): inizio metodo");

		LottiEsitoOutType risultato = new LottiEsitoOutType();

		try {
			List<LottoEsitoType> lotti = this.esitiManager
					.getLottiEsito(codiceGara);
			risultato.setLotto(lotti);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("lottiEsito: fine metodo");

		return risultato;

	}

	@Override
	public LottiGaraOutType getLottiGara(String codiceGara) {
		LOG.debug("lottiGara(" + codiceGara + "): inizio metodo");

		LottiGaraOutType risultato = new LottiGaraOutType();

		try {
			List<LottoGaraType> lotti = this.bandiManager
					.getLottiGara(codiceGara);

			LottoGaraType lotto = null;
			List<CategoriaGaraType> categorie = null;
			for (int i = 0; i < lotti.size(); i++) {
				lotto = lotti.get(i);
				categorie = this.bandiManager.getCategorieLotto(lotto
						.getCodiceLotto());
				lotto.setCategoria(categorie);
			}

			risultato.setLotto(lotti);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("lottiGara: fine metodo");

		return risultato;
	}

	@Override
	public LottiGaraOutType getLottiGaraPerDomandePartecipazione(
			String codiceGara, String progressivoOfferta) {
		LOG.debug("lottiGaraPerDomandePartecipazione(" + codiceGara
				+ "): inizio metodo");

		LottiGaraOutType risultato = new LottiGaraOutType();

		try {
			List<LottoGaraType> lotti = this.bandiManager
					.getLottiGaraPerDomandePartecipazione(codiceGara, progressivoOfferta);

			LottoGaraType lotto = null;
			List<CategoriaGaraType> categorie = null;
			for (int i = 0; i < lotti.size(); i++) {
				lotto = lotti.get(i);
				categorie = this.bandiManager.getCategorieLotto(lotto
						.getCodiceLotto());
				lotto.setCategoria(categorie);
			}

			risultato.setLotto(lotti);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("lottiGaraPerDomandePartecipazione: fine metodo");

		return risultato;
	}

	@Override
	public LottiGaraOutType getLottiGaraPerRichiesteOfferta(
			String tokenRichiedente, String codiceGara, String progressivoOfferta) {
		LOG.debug("lottiGaraPerRichiesteOfferta(" + tokenRichiedente
				+ "," + codiceGara + "): inizio metodo");

		LottiGaraOutType risultato = new LottiGaraOutType();

		try {
			List<LottoGaraType> lotti = this.bandiManager
					.getLottiGaraPerRichiesteOfferta(tokenRichiedente,
							codiceGara, progressivoOfferta);

			LottoGaraType lotto = null;
			List<CategoriaGaraType> categorie = null;
			for (int i = 0; i < lotti.size(); i++) {
				lotto = lotti.get(i);
				categorie = this.bandiManager.getCategorieLotto(lotto
						.getCodiceLotto());
				lotto.setCategoria(categorie);
			}

			risultato.setLotto(lotti);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("lottiGaraPerRichiesteOfferta: fine metodo");

		return risultato;
	}

	@Override
	public LottiGaraOutType getLottiGaraPlicoUnicoPerRichiesteOfferta(
			String tokenRichiedente, String codiceGara, String progressivoOfferta) {
		LOG.debug("lottiGaraPlicoUnicoPerRichiesteOfferta(" + tokenRichiedente
				+ "," + codiceGara + "): inizio metodo");

		LottiGaraOutType risultato = new LottiGaraOutType();

		try {
			List<LottoGaraType> lotti = this.bandiManager
					.getLottiGaraPlicoUnicoPerRichiesteOfferta(tokenRichiedente,
							codiceGara, progressivoOfferta);

			LottoGaraType lotto = null;
			List<CategoriaGaraType> categorie = null;
			for (int i = 0; i < lotti.size(); i++) {
				lotto = lotti.get(i);
				categorie = this.bandiManager.getCategorieLotto(lotto
						.getCodiceLotto());
				lotto.setCategoria(categorie);
			}

			risultato.setLotto(lotti);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("lottiGaraPlicoUnicoPerRichiesteOfferta: fine metodo");

		return risultato;
	}

	@Override
	public LottiGaraOutType getLottiGaraPerRichiesteCheckDocumentazione(
			String tokenRichiedente, String codiceGara) {
		LOG.debug("lottiGaraPerRichiesteCheckDocumentazione("
				+ tokenRichiedente + "," + codiceGara + "): inizio metodo");

		LottiGaraOutType risultato = new LottiGaraOutType();

		try {
			List<LottoGaraType> lotti = this.bandiManager
					.getLottiGaraPerRichiesteCheckDocumentazione(
							tokenRichiedente, codiceGara);

			LottoGaraType lotto = null;
			List<CategoriaGaraType> categorie = null;
			for (int i = 0; i < lotti.size(); i++) {
				lotto = lotti.get(i);
				categorie = this.bandiManager.getCategorieLotto(lotto
						.getCodiceLotto());
				lotto.setCategoria(categorie);
			}

			risultato.setLotto(lotti);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("lottiGaraPerRichiesteCheckDocumentazione: fine metodo");
		return risultato;
	}

	@Override
	public ElencoEsitiOutType searchEsiti(EsitoTypeSearch filtri) {
		LOG.debug("searchEsiti({},{},{},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getTipoAppalto(), filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA()
			, filtri.getProceduraTelematica(), filtri.getAltriSoggetti(), filtri.getSommaUrgenza()
			, filtri.getNumAnniPubblicazione()
		);

		ElencoEsitiOutType risultato = new ElencoEsitiOutType();

		try {
			int count = this.esitiManager.countEsiti(filtri);
			
			List<EsitoType> listaEsiti = this.esitiManager.searchEsiti(filtri);
			risultato.setElencoEsiti(listaEsiti);
			risultato.setNumEsiti(count);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("searchEsiti: fine metodo");
		return risultato;
	}

	@Override
	public ElencoEsitiOutType getElencoEsiti(EsitoTypeSearch filtri) {
		LOG.debug("elencoEsiti({},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getDataPubblicazioneA(), filtri.getProceduraTelematica(), filtri.getAltriSoggetti()
			, filtri.getSommaUrgenza(), filtri.getNumAnniPubblicazione()
		);

		ElencoEsitiOutType risultato = new ElencoEsitiOutType();

		try {
			int count = this.esitiManager.countElencoEsiti(filtri);
			
			List<EsitoType> listaEsiti = this.esitiManager.getElencoEsiti(filtri);
			risultato.setElencoEsiti(listaEsiti);
			risultato.setNumEsiti(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoEsiti: fine metodo");
		return risultato;
	}

	@Override
	public ElencoEsitiOutType getElencoEsitiAffidamenti(EsitoTypeSearch filtri) {
		LOG.debug("elencoEsitiAffidamento({},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getAltriSoggetti()
			, filtri.getSommaUrgenza(), filtri.getNumAnniPubblicazione()
		);

		ElencoEsitiOutType risultato = new ElencoEsitiOutType();

		try {
			int count = esitiManager.countElencoEsitiAffidamenti(filtri);
			
			List<EsitoType> listaEsiti = esitiManager.getElencoEsitiAffidamenti(filtri);
			risultato.setElencoEsiti(listaEsiti);
			risultato.setNumEsiti(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoEsitiAffidamento: fine metodo");
		return risultato;
	}

	@Override
	public DettaglioEsitoOutType getDettaglioEsito(String codiceGara) {
		LOG.debug("dettaglioEsito(" + codiceGara + "): inizio metodo");

		DettaglioEsitoOutType risultato = new DettaglioEsitoOutType();

		try {
			StazioneAppaltanteBandoType stazioneAppaltante = this.esitiManager
					.getStazioneAppaltanteEsito(codiceGara);
			EsitoType datiGenerali = this.esitiManager.getEsito(codiceGara);
			List<DocumentoAllegatoType> documenti = this.esitiManager
					.getDocumentiEsitoLotto(codiceGara, null);
			
			// per ogni lotto recupera anche tutti i documenti associati...
			List<DocumentoAllegatoLotto> lotti = this.esitiManager
				.getDocumentiLottiGaraConEsito(codiceGara);
			
			List<SoggettoAderenteType> soggettiAderenti = this.bandiManager
					.getSoggettiAderenti(codiceGara);

			DettaglioEsitoType esito = new DettaglioEsitoType();
			risultato.setEsito(esito);
			esito.setStazioneAppaltante(stazioneAppaltante);
			esito.setDatiGenerali(datiGenerali);
			esito.setDocumento(documenti);
			esito.setSoggettiAderenti(soggettiAderenti);

			// ciclo sui lotti per estrarre documenti di ogni singolo lotto
			List<LottoDettaglioGaraType> lottiGara = new ArrayList<LottoDettaglioGaraType>();
			LottoDettaglioGaraType lotto = null;
			List<DocumentoAllegatoType> documentiLotto = null;
			
			// per ogni lotto recupera i soggetti aderenti, in un'unica query
			// e ripartisci nel lotto corretto, ogni oggetto nella struttura 
			// relativa 
			List<SoggettoAderenteLotto> lottiSoggettiAderenti = this.bandiManager
				.getLottiSoggettiAderenti(codiceGara);

			for (DocumentoAllegatoLotto documentoAllegatoLotto : lotti) {
				// l'elenco delle coppie (lotto, documento) e' ordinato per
				// codice lotto...
				// per ogni coppia (lotto, documento) verifica se il lotto
				// in esame e' cambiato rispetto all'ultimo utilizzato
				// ed eventualmente crea un nuovo lotto nel quale inserire
				// buste, requisiti, soggeti e comunizazioni...
				boolean nuovoLotto = false;
				if ((lotto == null) ||
						(lotto != null && !documentoAllegatoLotto.getCodiceLotto().equalsIgnoreCase(lotto.getCodiceLotto()))) {
					// crea ed aggiungi il nuovo lotto...
					lotto = new LottoDettaglioGaraType();
					lotto.setCodiceLotto(documentoAllegatoLotto.getCodiceLotto());
					lotto.setCodiceInterno(documentoAllegatoLotto.getCodiceInterno());
					lotto.setOggetto(documentoAllegatoLotto.getOggetto());
					lotto.setCostoFisso(documentoAllegatoLotto.getCostoFisso());
					lottiGara.add(lotto);
					nuovoLotto = true;
				}

				// ...per il lotto corrente aggiungi i documenti (gruppo=4)
				// all'elenco dei documenti del lotto corrente...
				documentiLotto = lotto.getDocumento();
				if ("4".equalsIgnoreCase(documentoAllegatoLotto.getGruppo())) {
					// documenti di esiti (gruppo=4)
					if (documentiLotto == null) {
						documentiLotto = new ArrayList<DocumentoAllegatoType>();
					}
					documentiLotto.add(documentoAllegatoLotto);
				}
				lotto.setDocumento(documentiLotto);

				if (nuovoLotto) {
					// soggetti aderenti
					// estrai dalla query con tutte le coppie (lotto, soggetto)
					// i soggetti aderenti da aggiungere al lotto corrente
					soggettiAderenti = lotto.getSoggettiAderenti();
					if (lottiSoggettiAderenti != null) {
						for (int j = 0; j < lottiSoggettiAderenti.size(); j++) {
							if (documentoAllegatoLotto.getCodiceLotto().equalsIgnoreCase(lottiSoggettiAderenti.get(j).getCodiceLotto())) {
								if (soggettiAderenti == null) {
									soggettiAderenti = new ArrayList<SoggettoAderenteType>();
								}
								soggettiAderenti.add(lottiSoggettiAderenti.get(j));
							}
						}
					}
					lotto.setSoggettiAderenti(soggettiAderenti);
				}
			}
			esito.setLotto(lottiGara);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("dettaglioEsito: fine metodo");
		return risultato;
	}

	@Override
	public ElencoAvvisiOutType searchAvvisi(AvvisiTypeSearch filtri) {
		LOG.debug("searchAvvisi({},{},{};{},{},{},{},{};{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getTipoAvviso()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getAltriSoggetti(), filtri.getNumAnniPubblicazione());

		ElencoAvvisiOutType risultato = new ElencoAvvisiOutType();

		try {
			int count = avvisiManager.countAvvisi(filtri);
			
			List<AvvisoType> listaAvvisi = avvisiManager.searchAvvisi(filtri);
			risultato.setElencoAvvisi(listaAvvisi);
			risultato.setNumAvvisi(count);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("searchAvvisi: fine metodo");
		return risultato;
	}

	@Override
	public ElencoAvvisiOutType getElencoAvvisi(AvvisiTypeSearch filtri) {
		LOG.debug("elencoAvvisi({},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getTipoAvviso()
		  	, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getAltriSoggetti()
		);

		ElencoAvvisiOutType risultato = new ElencoAvvisiOutType();

		try {
			int count = avvisiManager.countElencoAvvisi(filtri);
			
			List<AvvisoType> listaAvvisi = avvisiManager.getElencoAvvisi(filtri);
			risultato.setElencoAvvisi(listaAvvisi);
			risultato.setNumAvvisi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoAvvisi: fine metodo");
		return risultato;
	}

	@Override
	public ElencoAvvisiOutType getElencoAvvisiScaduti(AvvisiTypeSearch filtri) {
		LOG.debug("elencoAvvisiScaduti({},{},{},{},{},{},[},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getTipoAvviso()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getAltriSoggetti(), filtri.getNumAnniPubblicazione()
		);

		ElencoAvvisiOutType risultato = new ElencoAvvisiOutType();

		try {
			int count = avvisiManager.countElencoAvvisiScaduti(filtri);
			
			List<AvvisoType> listaAvvisi = avvisiManager.getElencoAvvisiScaduti(filtri);
			risultato.setElencoAvvisi(listaAvvisi);
			risultato.setNumAvvisi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoAvvisiScaduti: fine metodo");
		return risultato;
	}

	@Override
	public DettaglioAvvisoOutType getDettaglioAvviso(String codiceGara) {
		LOG.debug("dettaglioAvviso(" + codiceGara + "): inizio metodo");

		DettaglioAvvisoOutType risultato = new DettaglioAvvisoOutType();

		try {
			StazioneAppaltanteBandoType stazioneAppaltante = this.avvisiManager
					.getStazioneAppaltanteAvviso(codiceGara);
			String codiceStazioneAppaltante = (stazioneAppaltante != null ? stazioneAppaltante.getCodice() : null);
			AvvisoType datiGenerali = this.avvisiManager.getAvviso(codiceGara);
			// i documenti di un avviso hanno codice gara = codice lotto e sono
			// sull'avviso perche' i lotti non esistono
			List<DocumentoAllegatoType> documenti = this.bandiManager
					.getDocumentiBandoLotto(codiceGara, codiceGara);
			List<SoggettoAderenteType> soggettiAderenti = this.bandiManager
					.getSoggettiAderenti(codiceGara);
			List<ComunicazioneType> comunicazioni = this.bandiManager
					.getComunicazioniPubbliche(codiceGara, null, codiceStazioneAppaltante);

			DettaglioAvvisoType avviso = new DettaglioAvvisoType();
			risultato.setAvviso(avviso);
			avviso.setStazioneAppaltante(stazioneAppaltante);
			avviso.setDatiGenerali(datiGenerali);
			avviso.setDocumento(documenti);
			avviso.setSoggettiAderenti(soggettiAderenti);
			avviso.setComunicazione(comunicazioni);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("dettaglioAvviso: fine metodo");
		return risultato;
	}

	@Override
	public ElencoBandiIscrizioneOutType searchBandiIscrizione(String token,
			Integer stato, String stazioneAppaltante, Boolean isAttivo) {
		LOG.debug("searchBandiIscrizione(" + token + "," + stato
				+ "): inizio metodo");

		ElencoBandiIscrizioneOutType risultato = new ElencoBandiIscrizioneOutType();

		try {
			List<BandoIscrizioneType> listaBandi = this.bandiManager
					.searchBandiIscrizione(token, stato, stazioneAppaltante, isAttivo);
			risultato.setElencoBandiIscrizione(listaBandi);
			risultato.setNumBandi(listaBandi.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("searchBandiIscrizione: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiIscrizioneOutType getElencoBandiIscrizione(String stazioneAppaltante, Boolean isAttivo) {
		LOG.debug("elencoBandiIscrizione(" + stazioneAppaltante + "): inizio metodo");

		ElencoBandiIscrizioneOutType risultato = new ElencoBandiIscrizioneOutType();

		try {
			List<BandoIscrizioneType> listaBandi = this.bandiManager
					.getElencoBandiIscrizione(stazioneAppaltante, isAttivo);
			risultato.setElencoBandiIscrizione(listaBandi);
			risultato.setNumBandi(listaBandi.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandiIscrizione: fine metodo");

		return risultato;
	}

	@Override
	public DettaglioBandoIscrizioneOutType getDettaglioBandoIscrizione(
			String codiceBandoIscrizione, String stazioneAppaltante) {
		LOG.debug("dettaglioBandoIscrizione(" + codiceBandoIscrizione
				+ stazioneAppaltante + "): inizio metodo");

		DettaglioBandoIscrizioneOutType risultato = new DettaglioBandoIscrizioneOutType();

		try {
			BandoIscrizioneType datiGeneraliBando = this.bandiManager
					.getBandoIscrizione(codiceBandoIscrizione);
			if (datiGeneraliBando != null) {
				StazioneAppaltanteBandoType sa = this.bandiManager
						.getStazioneAppaltanteBandoIscrizione(codiceBandoIscrizione);
				List<DocumentoAllegatoType> documenti = this.bandiManager
						.getDocumentiBandoIscrizione(codiceBandoIscrizione);
				List<RequisitoRichiestoType> requisitiRichiesti = this.bandiManager
						.getRequisitiRichiestiBandoIscrizione(codiceBandoIscrizione);
				List<ComunicazioneType> comunicazioni = this.bandiManager
						.getComunicazioniPubbliche(codiceBandoIscrizione, null, stazioneAppaltante);

				DettaglioBandoIscrizioneType bando = new DettaglioBandoIscrizioneType();
				risultato.setBandoIscrizione(bando);
				bando.setStazioneAppaltante(sa);
				bando.setDatiGeneraliBandoIscrizione(datiGeneraliBando);
				bando.setDocumento(documenti);
				bando.setRequisitoRichiesto(requisitiRichiesti);
				bando.setComunicazione(comunicazioni);
			}

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("dettaglioBandoIscrizione: fine metodo");

		return risultato;
	}

	@Override
	public CategorieBandoIscrizioneOutType getCategorieBandoIscrizione(
			String codiceBandoIscrizione, String filtroCategorie) {
		LOG.debug("categorieBandoIscrizione(" + codiceBandoIscrizione
				+ "," + filtroCategorie + "): inizio metodo");

		CategorieBandoIscrizioneOutType risultato = new CategorieBandoIscrizioneOutType();

		try {
			List<CategoriaBandoIscrizioneType> categorie = this.bandiManager
					.getCategorieBandoIscrizione(codiceBandoIscrizione,
							filtroCategorie);
			risultato.setCategoria(categorie);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("categorieBandoIscrizione: fine metodo");

		return risultato;
	}

	@Override
	public GetStatisticheComunicazioniPersonaliOutType getStatisticheComunicazioniPersonali(
			String tokenRichiedente, 
			String codice, 
			String codice2,
			String entita,
			String stazioneAppaltante) {
		LOG.debug("getStatisticheComunicazioniPersonali(" + tokenRichiedente + ","
				+ codice + "," + stazioneAppaltante
				+ "): inizio metodo");

		GetStatisticheComunicazioniPersonaliOutType risultato = new GetStatisticheComunicazioniPersonaliOutType();

		try {
			risultato.setStatistiche(this.bandiManager
					.getStatisticheComunicazioniPersonali(
							tokenRichiedente, 
							codice,
							codice2,
							entita,
							stazioneAppaltante));
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getStatisticheComunicazioniPersonali: fine metodo");

		return risultato;
	}

	@Override
	public GetStatisticheComunicazioniPersonaliOutType getStatisticheComunicazioniPersonaliGaraLotti(
			String tokenRichiedente, 
			String codiceGara, 
			String entita,
			String stazioneAppaltante) {
		LOG.debug("getStatisticheComunicazioniPersonaliGaraLotti("
				+ tokenRichiedente + ","
				+ codiceGara + ","
				+ entita + ","
				+ stazioneAppaltante
				+ "): inizio metodo");

		GetStatisticheComunicazioniPersonaliOutType risultato = new GetStatisticheComunicazioniPersonaliOutType();

		try {
			risultato.setStatistiche(this.bandiManager
					.getStatisticheComunicazioniPersonaliGaraLotti(
							tokenRichiedente, 
							codiceGara,
							entita,
							stazioneAppaltante));
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getStatisticheComunicazioniPersonaliGaraLotti: fine metodo");

		return risultato;
	}

	@Override
	public ComunicazioniPersonaliOutType getComunicazioniPersonaliRicevute(
			String tokenRichiedente, 
			String codice, 
			String codice2,
			Boolean soccorsoIstruttorio,
			String entita,
			int indicePrimoRecord, int maxNumRecord,
			String stazioneAppaltante) {
		LOG.debug("getComunicazioniPersonaliRicevute("
				+ tokenRichiedente + ","
				+ codice + ","
				+ soccorsoIstruttorio + ","
				+ entita + ","
				+ indicePrimoRecord + "," + maxNumRecord + ","
				+ stazioneAppaltante
				+ "): inizio metodo");

		ComunicazioniPersonaliOutType risultato = new ComunicazioniPersonaliOutType();

		try {
			risultato.setNumElementiTotali(this.bandiManager
					.countComunicazioniRicevute(
							tokenRichiedente, 
							codice, 
							codice2,
							soccorsoIstruttorio,
							entita,
							false, 
							stazioneAppaltante));
			if (risultato.getNumElementiTotali() > 0) {
				List<ComunicazioneType> comunicazioni = this.bandiManager
						.getComunicazioniRicevute(
								tokenRichiedente, 
								codice,
								soccorsoIstruttorio,
								entita,
								indicePrimoRecord, maxNumRecord, 
								stazioneAppaltante);
				risultato.setComunicazione(comunicazioni);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getComunicazioniPersonaliRicevute: fine metodo");

		return risultato;
	}
	
	@Override
	public ComunicazioniPersonaliOutType getComunicazioniPersonaliRicevuteGaraLotti(
			String tokenRichiedente, 
			String codiceGara,
			Boolean soccorsoIstruttorio,
			String entita,
			int indicePrimoRecord, int maxNumRecord,
			String stazioneAppaltante) {
		LOG.debug("getComunicazioniPersonaliRicevuteGaraLotti("
				+ tokenRichiedente + ","
				+ codiceGara + ","
				+ soccorsoIstruttorio + ","
				+ entita + ","
				+ indicePrimoRecord + "," + maxNumRecord + ","
				+ stazioneAppaltante
				+ "): inizio metodo");

		ComunicazioniPersonaliOutType risultato = new ComunicazioniPersonaliOutType();

		try {
			String[] codiciLotto = this.bandiManager.getCodiciLotto(codiceGara);

			risultato.setNumElementiTotali(this.bandiManager
					.countComunicazioniRicevuteGaraLotti(
							tokenRichiedente, 
							codiciLotto,
							false,			//soccorsoIstruttorio 
							entita,
							false,
							stazioneAppaltante));
			if (risultato.getNumElementiTotali() > 0) {
				List<ComunicazioneType> comunicazioni = this.bandiManager
						.getComunicazioniRicevuteGaraLotti(
								tokenRichiedente, 
								codiciLotto,
								false,			//soccorsoIstruttorio
								entita,
								indicePrimoRecord, maxNumRecord,
								stazioneAppaltante);
				risultato.setComunicazione(comunicazioni);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getComunicazioniPersonaliRicevuteGaraLotti: fine metodo");

		return risultato;
	}

	@Override
	public ComunicazioniPersonaliOutType getComunicazioniPersonaliArchiviate(
			String tokenRichiedente, 
			String codice,
			String codice2,
			Boolean soccorsoIstruttorio,
			String entita,
			int indicePrimoRecord, int maxNumRecord,
			String stazioneAppaltante) {
		LOG.debug("getComunicazioniPersonaliArchiviate("
				+ tokenRichiedente + ","
				+ codice + ","
				+ soccorsoIstruttorio + ","
				+ entita + ","
				+ indicePrimoRecord + "," + maxNumRecord + ","
				+ stazioneAppaltante
				+ "): inizio metodo");

		ComunicazioniPersonaliOutType risultato = new ComunicazioniPersonaliOutType();

		try {
			risultato.setNumElementiTotali(this.bandiManager
					.countComunicazioniArchiviate(
							tokenRichiedente, 
							codice,
							codice2,
							soccorsoIstruttorio,
							entita,
							false, 
							stazioneAppaltante));
			if (risultato.getNumElementiTotali() > 0) {
				List<ComunicazioneType> comunicazioni = this.bandiManager
						.getComunicazioniArchiviate(
								tokenRichiedente, 
								codice,
								soccorsoIstruttorio,
								entita,
								indicePrimoRecord, maxNumRecord, 
								stazioneAppaltante);
				risultato.setComunicazione(comunicazioni);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getComunicazioniPersonaliArchiviate: fine metodo");

		return risultato;
	}

	@Override
	public ComunicazioniPersonaliOutType getComunicazioniPersonaliArchiviateGaraLotti(
			String tokenRichiedente, 
			String codiceGara, 
			Boolean soccorsoIstruttorio,
			String entita,
			int indicePrimoRecord, int maxNumRecord,
			String stazioneAppaltante) {
			LOG.debug("getComunicazioniPersonaliArchiviateGaraLotti("
					+ tokenRichiedente + ","
					+ codiceGara + "," 
					+ soccorsoIstruttorio + ","
					+ entita + ","
					+ indicePrimoRecord + "," + maxNumRecord + ","
					+ stazioneAppaltante
					+ "): inizio metodo");

		ComunicazioniPersonaliOutType risultato = new ComunicazioniPersonaliOutType();

		try {
			String[] codiciLotto = this.bandiManager.getCodiciLotto(codiceGara);

			risultato.setNumElementiTotali(this.bandiManager
					.countComunicazioniArchiviateGaraLotti(
							tokenRichiedente, 
							codiciLotto,
							soccorsoIstruttorio,
							entita,
							false, 
							stazioneAppaltante));
			if (risultato.getNumElementiTotali() > 0) {
				List<ComunicazioneType> comunicazioni = this.bandiManager
						.getComunicazioniArchiviateGaraLotti(
								tokenRichiedente, 
								codiciLotto,
								soccorsoIstruttorio,
								entita,
								indicePrimoRecord, maxNumRecord,
								stazioneAppaltante);
				risultato.setComunicazione(comunicazioni);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getComunicazioniPersonaliArchiviateGaraLotti: fine metodo");

		return risultato;
	}

	@Override
	public ComunicazioniPersonaliOutType getComunicazioniPersonaliInviate(
			String tokenRichiedente, 
			String codice, 
			String codice2, 
			String entita,
			int indicePrimoRecord, int maxNumRecord,
			String stazioneAppaltante) {
			LOG.debug("getComunicazioniPersonaliInviate(" + tokenRichiedente + ","
					+ codice + "," + indicePrimoRecord + "," + maxNumRecord + ","
					+ stazioneAppaltante
					+ "): inizio metodo");

		ComunicazioniPersonaliOutType risultato = new ComunicazioniPersonaliOutType();

		try {
			risultato.setNumElementiTotali(this.bandiManager
					.countComunicazioniInviate(
							tokenRichiedente, 
							codice, 
							codice2,
							entita,
							stazioneAppaltante));
			if (risultato.getNumElementiTotali() > 0) {
				List<ComunicazioneType> comunicazioni = this.bandiManager
						.getComunicazioniInviate(
								tokenRichiedente, 
								codice,
								entita,
								indicePrimoRecord, maxNumRecord,
								stazioneAppaltante);
				risultato.setComunicazione(comunicazioni);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getComunicazioniPersonaliInviate: fine metodo");

		return risultato;
	}

	@Override
	public ComunicazionePersonaleOutType getComunicazionePersonaleRicevuta(
			String tokenRichiedente, long idComunicazione, long idDestinatario, String idprg) {
		LOG.debug("getComunicazionePersonaleRicevuta(" + tokenRichiedente + ","
				+ idComunicazione + "," + idDestinatario
				+ "): inizio metodo");

		ComunicazionePersonaleOutType risultato = new ComunicazionePersonaleOutType();

		try {
			ComunicazioneType comunicazione = this.bandiManager
					.getComunicazioneRicevuta(tokenRichiedente, idComunicazione, idDestinatario, idprg);
			risultato.setComunicazione(comunicazione);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getComunicazionePersonaleRicevuta: fine metodo");

		return risultato;
	}

	@Override
	public ComunicazionePersonaleOutType getComunicazionePersonaleInviata(
			String tokenRichiedente, long idComunicazione, String idprg) {
		LOG.debug("getComunicazionePersonaleInviata(" + tokenRichiedente + ","
				+ idComunicazione
				+ "): inizio metodo");

		ComunicazionePersonaleOutType risultato = new ComunicazionePersonaleOutType();

		try {
			ComunicazioneType comunicazione = this.bandiManager
					.getComunicazioneInviata(tokenRichiedente, idComunicazione, idprg);
			risultato.setComunicazione(comunicazione);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getComunicazionePersonaleInviata: fine metodo");

		return risultato;
	}

	  @Override
      public ElencoInviiOutType getElencoInvii(String tokenRichiedente,
                  String codice, List<String> tipiComunicazione) {
		  LOG.debug("getElencoInvii(" + tokenRichiedente
					 + "," + codice + ", ["
					 + StringUtils.join(tipiComunicazione, ',') + "]"
					 + "): inizio metodo");

            ElencoInviiOutType risultato = new ElencoInviiOutType();
 
            try {
                  String[] tipi = new String[tipiComunicazione.size()];
                  for(int i = 0; i < tipiComunicazione.size(); i++) {
                        tipi[i] = tipiComunicazione.get(i);
                  }
                 
                  List<InvioType> invii = this.bandiManager.getElencoInvii(
                             tokenRichiedente, codice, tipi);
                  risultato.setInvio(invii);
            } catch (DataAccessException e) {
				LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
                  risultato.setErrore(e.getMessage());
            }
 
		  	LOG.debug("getElencoInvii: fine metodo");
 
            return risultato;
      }

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiElencoOperatori()
	 */
	@Override
	public String getElencoTipiElencoOperatori() {
		LOG.debug("elencoTipiElencoOperatori: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A1071");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiElencoOperatori: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiClassifica()
	 */
	@Override
	public String getElencoTipiClassifica() {
		LOG.debug("elencoTipiClassifica: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A2088");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiClassifica: fine metodo");

		return documentoXML;
	}

	@Override
	public GetDatiImpresaOutType getDatiImpresa(String token, Date dataPartenzaCessati) {
		LOG.debug("getDatiImpresa("
				+ token	+ ","
				+ UtilityDate.convertiData(dataPartenzaCessati, UtilityDate.FORMATO_GG_MM_AAAA)
				+ "): inizio metodo");

		GetDatiImpresaOutType risultato = new GetDatiImpresaOutType();

		try {
			// estrazione del set di dati
			DatiImpresaDocument document = this.impreseGaraManager
					.getDatiImpresa(token, dataPartenzaCessati);

			// validazione a pezzi delle informazioni in modo da fornire un
			// messaggio di errore significativo
			boolean controlliOK = true;

			if (controlliOK && document == null) {
				controlliOK = false;
				risultato.setErrore("Non e' stata individuata l'impresa");
				LOG.error(risultato.getErrore());
			}
			if (controlliOK
					&& !checkValidazione(
							document.getDatiImpresa().getImpresa(), "<impresa>")) {
				controlliOK = false;
				risultato.setErrore("Mancano dati obbligatori di dettaglio dell'impresa");
			}
			if (controlliOK
					&& document.getDatiImpresa()
							.sizeOfLegaleRappresentanteArray() > 0) {
				for (int i = 0; i < document.getDatiImpresa()
						.sizeOfLegaleRappresentanteArray() && controlliOK; i++) {
					if (!checkValidazione(
							document.getDatiImpresa().getLegaleRappresentanteArray()[i],
							"<legaleRappresentante>")) {
						controlliOK = false;
						risultato.setErrore("Mancano dati obbligatori di dettaglio del legale rappresentante in posizione" + (i + 1));
					}
				}
			}
			if (controlliOK
					&& document.getDatiImpresa().sizeOfDirettoreTecnicoArray() > 0) {
				for (int i = 0; i < document.getDatiImpresa()
						.sizeOfDirettoreTecnicoArray() && controlliOK; i++) {
					if (!checkValidazione(document.getDatiImpresa()
							.getDirettoreTecnicoArray()[i],
							"<direttoreTecnico>")) {
						controlliOK = false;
						risultato
								.setErrore("Mancano dati obbligatori di dettaglio del direttore tecnico in posizione"
										+ (i + 1));
					}
				}
			}
			if (controlliOK
					&& document.getDatiImpresa().sizeOfAltraCaricaArray() > 0) {
				for (int i = 0; i < document.getDatiImpresa()
						.sizeOfAltraCaricaArray() && controlliOK; i++) {
					if (!checkValidazione(document.getDatiImpresa()
							.getAltraCaricaArray()[i], "<altraCarica>")) {
						controlliOK = false;
						risultato
								.setErrore("Mancano dati obbligatori di dettaglio del soggetto con altra carica in posizione"
										+ (i + 1));
					}
				}
			}
			if (controlliOK
					&& document.getDatiImpresa().sizeOfCollaboratoreArray() > 0) {
				for (int i = 0; i < document.getDatiImpresa()
						.sizeOfCollaboratoreArray() && controlliOK; i++) {
					if (!checkValidazione(document.getDatiImpresa()
							.getCollaboratoreArray()[i], "<collaboratore>")) {
						controlliOK = false;
						risultato
								.setErrore("Mancano dati obbligatori di dettaglio del collaboratore in posizione"
										+ (i + 1));
					}
				}
			}
			// if (controlliOK
			// && !checkValidazione(document.getDatiImpresa(),
			// "<DatiImpresa>")) {
			// controlliOK = false;
			// risultato
			// .setErrore("Mancano dati obbligatori per il dettaglio dell'impresa");
			// }

			if (controlliOK)
				risultato.setDatiImpresa(document.toString());

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (Throwable e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getDatiImpresa: fine metodo");

		return risultato;
	}

	@Override
	public GetDocumentiRichiestiBandoOutType getDocumentiRichiestiBandoGara(
			String codiceGara, String codiceLotto, String tipoImpresa,
			boolean rti, String busta) {
		LOG.debug("documentiRichiestiBandoGara(" + codiceGara + ","
				+ codiceLotto + "," + tipoImpresa + "," + rti + "," + busta
				+ "): inizio metodo");

		GetDocumentiRichiestiBandoOutType risultato = new GetDocumentiRichiestiBandoOutType();

		try {
			List<DocumentazioneRichiestaType> requisiti = this.bandiManager
					.getDocumentiRichiestiBandoGara(codiceGara, codiceLotto,
							tipoImpresa, rti, busta);
			risultato.setDocumento(requisiti);
		} catch (DataAccessException e) {
			LOG.error(
					"Errore inaspettato durante l'interazione con la base dati",
					e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("documentiRichiestiBandoGara: fine metodo");

		return risultato;
	}

	@Override
	public GetDocumentiRichiestiBandoGaraPlicoUnicoOutType getDocumentiRichiestiBandoGaraPlicoUnico(
			String codiceGara, String tipoImpresa,
			boolean rti) {
		LOG.debug("documentiRichiestiBandoGaraPlicoUnico(" + codiceGara + ","
				+ tipoImpresa + "," + rti + "," + "): inizio metodo");

		GetDocumentiRichiestiBandoGaraPlicoUnicoOutType risultato = new GetDocumentiRichiestiBandoGaraPlicoUnicoOutType();

		try {
			// la documentazione amministrativa e' collegata al lotto fittizio con codice lotto = codice gara
			List<DocumentazioneRichiestaType> docBustaAmm = this.bandiManager
					.getDocumentiRichiestiBandoGara(codiceGara, codiceGara,
							tipoImpresa, rti, BUSTA_AMMINISTRATIVA);
			risultato.setDocumentoBustaAmministrativa(docBustaAmm);

			// si estrae la documentazione tecnica ed economica richiesta comune (cioe' indipendente dal lotto)
			List<DocumentazioneRichiestaType> documentiComuniBusteTecniche = this.bandiManager
					.getDocumentiRichiestiBandoGara(codiceGara, null,
							tipoImpresa, rti, BUSTA_TECNICA);
			List<DocumentazioneRichiestaType> documentiComuniBusteEconomiche = this.bandiManager
					.getDocumentiRichiestiBandoGara(codiceGara, null,
							tipoImpresa, rti, BUSTA_ECONOMICA);

			// si estraggono i lotti e si crea la lista documenti richiesti per ogni lotto
			List<LottoGaraType> lotti = this.bandiManager.getLottiGara(codiceGara);
			List<LottoDettaglioGaraType> lottiGara = new ArrayList<LottoDettaglioGaraType>();
			LottoDettaglioGaraType lotto = null;
			List<DocumentazioneRichiestaType> documentiBustaTecnicaLotto = null;
			List<DocumentazioneRichiestaType> documentiBustaEconomicaLotto = null;
			for (int i = 0; i < lotti.size(); i++) {
				lotto = new LottoDettaglioGaraType();
				lotto.setCodiceLotto(lotti.get(i).getCodiceLotto());
				lotto.setCodiceInterno(lotti.get(i).getCodiceInterno());
				lotto.setOggetto(lotti.get(i).getOggetto());
				lotto.setCostoFisso(lotti.get(i).getCostoFisso());
				documentiBustaTecnicaLotto = this.bandiManager
						.getDocumentiRichiestiBandoGara(codiceGara,
								lotto.getCodiceLotto(), tipoImpresa, rti,
								BUSTA_TECNICA);
				DocumentazioneRichiestaType[] docBustaTecnica = fillDocumentazioneRichiesta(documentiComuniBusteTecniche, documentiBustaTecnicaLotto);
				lotto.setDocumentoBustaTecnica(Arrays.asList(docBustaTecnica));
				documentiBustaEconomicaLotto = this.bandiManager
						.getDocumentiRichiestiBandoGara(codiceGara,
								lotto.getCodiceLotto(), tipoImpresa, rti,
								BUSTA_ECONOMICA);
				DocumentazioneRichiestaType[] docBustaEconomica = fillDocumentazioneRichiesta(documentiComuniBusteEconomiche, documentiBustaEconomicaLotto);
				lotto.setDocumentoBustaEconomica(Arrays.asList(docBustaEconomica));
				lottiGara.add(lotto);
			}
			risultato.setLotti(lottiGara);
		} catch (DataAccessException e) {
			LOG.error(
					"Errore inaspettato durante l'interazione con la base dati",
					e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("documentiRichiestiBandoGaraPlicoUnico: fine metodo");

		return risultato;
	}

	private DocumentazioneRichiestaType[] fillDocumentazioneRichiesta(
			List<DocumentazioneRichiestaType> documentiComuni,
			List<DocumentazioneRichiestaType> documentiLotto) {
		DocumentazioneRichiestaType[] docBusta = new DocumentazioneRichiestaType[documentiComuni.size() + documentiLotto.size()];
		for (int j = 0; j < documentiComuni.size(); j++) {
			docBusta[j] = documentiComuni.get(j);
		}
		for (int j = 0; j < documentiLotto.size(); j++) {
			docBusta[documentiComuni.size() + j] = documentiLotto.get(j);
		}
		return docBusta;
	}

	@Override
	public GetDocumentiRichiestiBandoOutType getDocumentiRichiestiBandoIscrizione(
			String codice, String tipoImpresa, boolean rti) {
		LOG.debug("documentiRichiestiBandoIscrizione(" + codice + ","
				+ tipoImpresa + "," + rti + "): inizio metodo");

		GetDocumentiRichiestiBandoOutType risultato = new GetDocumentiRichiestiBandoOutType();

		try {
			List<DocumentazioneRichiestaType> requisiti = this.bandiManager
					.getDocumentiRichiestiBandoIscrizione(codice, tipoImpresa, rti);
			risultato.setDocumento(requisiti);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("documentiRichiestiBandoIscrizione: fine metodo");

		return risultato;
	}

	@Override
	public GetDocumentiRichiestiBandoOutType getDocumentiRichiestiRinnovoIscrizione(
			String codice, String tipoImpresa, boolean rti) {
		LOG.debug("documentiRichiestiRinnovoIscrizione(" + codice + ","
				+ tipoImpresa + "," + rti + "): inizio metodo");

		GetDocumentiRichiestiBandoOutType risultato = new GetDocumentiRichiestiBandoOutType();

		try {
			List<DocumentazioneRichiestaType> requisiti = bandiManager
					.getDocumentiRichiestiRinnovoIscrizione(codice, tipoImpresa, rti);
			risultato.setDocumento(requisiti);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("documentiRichiestiRinnovoIscrizione: fine metodo");

		return risultato;
	}

	@Override
	public GetDocumentiRichiestiBandoOutType getDocumentiRichiestiComunicazione(
			String idPrg, long idComunicazione) {
		LOG.debug("documentiRichiestiComunicazione(" + idPrg + ","
				+ idComunicazione + "): inizio metodo");

		GetDocumentiRichiestiBandoOutType risultato = new GetDocumentiRichiestiBandoOutType();
		try {
			List<DocumentazioneRichiestaType> requisiti = bandiManager
					.getDocumentiRichiestiComunicazione(idPrg, idComunicazione);
			risultato.setDocumento(requisiti);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("documentiRichiestiComunicazione: fine metodo");

		return risultato;
	}

	@Override
	public StatoIscrizioneABandoIscrizioneOutType getStatoIscrizioneABandoIscrizione(
			String tokenRichiedente, String codice) {
		LOG.debug("statoIscrizioneABandoIscrizione(" + tokenRichiedente
				+ "," + codice + "): inizio metodo");

		StatoIscrizioneABandoIscrizioneOutType risultato = new StatoIscrizioneABandoIscrizioneOutType();

		try {
			Integer stato = this.bandiManager
					.getStatoIscrizioneABandoIscrizione(tokenRichiedente,
							codice);
			risultato.setStato(stato);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("statoIscrizioneABandoIscrizione: fine metodo");

		return risultato;
	}

	/**
	 * Effettua la validazione di un oggetto XmlBeans, tracciando sul log gli
	 * errori riscontrati
	 * 
	 * @param oggetto
	 *            oggetto da validare
	 * @param tag
	 *            tag oggetto della validazione
	 * @return true se i controlli sintattici sono andati a buon fine, false
	 *         altrimenti
	 */
	private boolean checkValidazione(XmlObject oggetto, String tag) {
		XmlOptions validationOptions = new XmlOptions();
		List<XmlError> validationErrors = new ArrayList<>();
		validationOptions.setErrorListener(validationErrors);
		boolean esitoCheckSintassi = oggetto.validate(validationOptions);

		if (!esitoCheckSintassi) {
			StringBuilder sb = new StringBuilder(
					"Si sono verificati errori durante la validazione del tag ")
					.append(tag).append(":\n");
			for (int i = 0; i < validationErrors.size(); i++) {
				XmlValidationError currValError = (XmlValidationError) validationErrors.get(i);
				if (currValError.getOffendingQName() != null)
					sb.append(
							currValError.getOffendingQName()
									.getLocalPart()).append(": ");
				sb.append(currValError.getMessage()).append("\n");
			}
			LOG.error(sb.toString());
		}
		return esitoCheckSintassi;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiImpresaPerIscrizione()
	 */
	@Override
	public String getElencoTipiImpresaPerIscrizione() {
		LOG.debug("elencoTipiImpresaPerIscrizione: inizio metodo");

		List<DatoCodificatoType> lista = this.impreseGaraManager
				.getElencoTipiImpresaPerIscrizione();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiImpresaPerIscrizione: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiImpresaDittaIndividuale()
	 */
	@Override
	public String getElencoTipiImpresaDittaIndividuale() {
		LOG.debug("elencoTipiImpresaDittaIndividuale: inizio metodo");

		List<DatoCodificatoType> lista = this.impreseGaraManager
				.getElencoTipiImpresaDittaIndividuale();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiImpresaDittaIndividuale: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiImpresaLiberoProfessionista()
	 */
	@Override
	public String getElencoTipiImpresaLiberoProfessionista() {
		LOG.debug("elencoTipiImpresaLiberoProfessionista: inizio metodo");

		List<DatoCodificatoType> lista = this.impreseGaraManager
				.getElencoTipiImpresaLiberoProfessionista();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiImpresaLiberoProfessionista: fine metodo");

		return documentoXML;
	}
	
	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiImpresaSociale()
	 */
	@Override
	public String getElencoTipiImpresaSociale() {
		LOG.debug("getElencoTipiImpresaSociale: inizio metodo");

		List<DatoCodificatoType> lista = this.impreseGaraManager
				.getElencoTipiImpresaSociale();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("getElencoTipiImpresaSociale: fine metodo");

		return documentoXML;
	}
	

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiImpresaConsorzio()
	 */
	@Override
	public String getElencoTipiImpresaConsorzio() {
		LOG.debug("elencoTipiImpresaConsorzio: inizio metodo");

		List<DatoCodificatoType> lista = this.impreseGaraManager
				.getElencoTipiImpresaConsorzio();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiImpresaConsorzio: fine metodo");

		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoStatiIscrizioneElencoOperatori()
	 */
	@Override
	public String getElencoStatiIscrizioneElencoOperatori() {
		LOG.debug("elencoStatiIscrizioneElencoOperatori: inizio metodo");

		List<DatoCodificatoType> lista = this.bandiManager
				.getStatiIscrizioneElencoOperatori();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoStatiIscrizioneElencoOperatori: fine metodo");

		return documentoXML;
	}

	@Override
	public ElencoBandiOutType getElencoBandiPerRichiesteOfferta(GaraTypeSearch filtri) {
		LOG.debug("elencoBandiPerRichiesteOfferta({},{},{},{},{},{},{},},{},{},{},{},{},{}); inizio metodo"
			, filtri.getTokenRichiedente(), filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getTipoAppalto(), filtri.getDataScadenzaDa(), filtri.getDataScadenzaA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getProceduraTelematica(), filtri.getStato(), filtri.getSommaUrgenza()
			, filtri.getAltriSoggetti()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();

		try {
			int count = this.bandiManager.countElencoBandiPerRichiesteOfferta(filtri);
			
			List<GaraType> listaGare = this.bandiManager
					.getElencoBandiPerRichiesteOfferta(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandiPerRichiesteOfferta: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType getElencoBandiPerRichiesteOffertaPrivatistiche(GaraTypeSearch filtri) {
		LOG.debug("elencoBandiPerRichiesteOffertaPrivatistiche({},{},{},{},{},{},{},{},{},{},{},{},{},{}: inizio metodo"
			, filtri.getTokenRichiedente(), filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getTipoAppalto(), filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA()
			, filtri.getDataScadenzaDa(), filtri.getDataScadenzaA(), filtri.getProceduraTelematica(), filtri.getStato()
			, filtri.getSommaUrgenza(), filtri.getAltriSoggetti(), filtri.getGaraPrivatistica()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();

		try {
			int count = this.bandiManager.countElencoBandiPerRichiesteOfferta(filtri);
			
			List<GaraType> listaGare = this.bandiManager
					.getElencoBandiPerRichiesteOfferta(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandiPerRichiesteOffertaPrivatistiche: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType getElencoBandiPerRichiesteCheckDocumentazione(GaraTypeSearch filtri) {
		LOG.debug("elencoBandiPerRichiesteCheckDocumentazione({},{},{},{},{},{},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getTokenRichiedente(), filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getTipoAppalto(), filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA()
			, filtri.getDataScadenzaDa(), filtri.getDataScadenzaA(), filtri.getProceduraTelematica()
			, filtri.getStato(), filtri.getAltriSoggetti(), filtri.getSommaUrgenza()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();
		try {
			int count = bandiManager.countElencoBandiPerRichiesteCheckDocumentazione(filtri);
			
			List<GaraType> listaGare = bandiManager.getElencoBandiPerRichiesteCheckDocumentazione(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandiPerRichiesteCheckDocumentazione: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType getElencoBandiPerAsteInCorso(GaraTypeSearch filtri) {
		LOG.debug("elencoBandiPerAsteInCorso({},{},{},{},{},{},{},{},{},{},{},{},{}): inizio metodo",
			  filtri.getTokenRichiedente(), filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getTipoAppalto(), filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA()
			, filtri.getDataScadenzaDa(), filtri.getDataScadenzaA(), filtri.getProceduraTelematica()
			, filtri.getStato(), filtri.getAltriSoggetti(), filtri.getSommaUrgenza()
		  );

		ElencoBandiOutType risultato = new ElencoBandiOutType();

		try {
			int count = this.bandiManager.countBandiPerAsteInCorso(filtri);

			List<GaraType> listaGare = this.bandiManager
					.getElencoBandiPerAsteInCorso(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoBandiPerAsteInCorso: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType countBandiPerAsteInCorso(GaraTypeSearch filtri) {
		LOG.debug("countBandiPerAsteInCorso({},{},{},{},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getTokenRichiedente(), filtri.getStazioneAppaltante(), filtri.getOggetto()
			, filtri.getCig(), filtri.getTipoAppalto(), filtri.getDataPubblicazioneDa()
			, filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa(), filtri.getDataScadenzaA()
			, filtri.getProceduraTelematica(), filtri.getStato()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();
		try {
			int count = this.bandiManager.countBandiPerAsteInCorso(filtri);
			risultato.setElencoBandi(null);
			risultato.setNumBandi(count);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("countBandiPerAsteInCorso: fine metodo");

		return risultato;
	}

	@Override
	public GetAbilitazioniGaraOutType getAbilitazioniGara(
			String tokenRichiedente, String codice) {
		LOG.debug("abilitazioniGara(" + tokenRichiedente + "," + codice
				+ "): inizio metodo");

		GetAbilitazioniGaraOutType risultato = new GetAbilitazioniGaraOutType();

		try {
			AbilitazioniGaraType abilitazioni = this.bandiManager
					.getAbilitazioniGara(tokenRichiedente, codice);
			risultato.setAbilitazioni(abilitazioni);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("abilitazioniGara: fine metodo");

		return risultato;
	}

	@Override
	public TipoPartecipazioneImpresaOutType getTipoPartecipazioneImpresa(
			String tokenRichiedente, String codice, String progOfferta) {
		LOG.debug("tipoPartecipazioneImpresa(" + tokenRichiedente + ","
				+ codice + "," + progOfferta + "): inizio metodo");

		TipoPartecipazioneImpresaOutType risultato = new TipoPartecipazioneImpresaOutType();

		try {
			TipoPartecipazioneType tipoPartecipazione = this.bandiManager
					.getTipoPartecipazioneImpresa(tokenRichiedente, codice, progOfferta);
			risultato.setTipoPartecipazione(tipoPartecipazione);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("tipoPartecipazioneImpresa: fine metodo");

		return risultato;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoStazioniAppaltantiPerIscrizione(java.lang.String)
	 */
	@Override
	public String getElencoStazioniAppaltantiPerIscrizione(
			String codiceBandoIscrizione) {
		LOG.debug("elencoStazioniAppaltantiPerIscrizione("
				+ codiceBandoIscrizione + "): inizio metodo");

		List<DatoCodificatoType> lista = this.bandiManager
				.getElencoStazioniAppaltantiPerIscrizione(codiceBandoIscrizione);
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoStazioniAppaltantiPerIscrizione: fine metodo");

		return documentoXML;
	}

	@Override
	public CategorieImpresaPerIscrizioneOutType getCategorieImpresaPerIscrizione(
			String tokenRichiedente, String codiceBandoIscrizione) {
		LOG.debug("categorieImpresaPerIscrizione(" + tokenRichiedente
				+ "," + codiceBandoIscrizione + "): inizio metodo");

		CategorieImpresaPerIscrizioneOutType risultato = new CategorieImpresaPerIscrizioneOutType();

		try {
			List<CategoriaImpresaType> categorie = this.bandiManager
					.getCategorieImpresaPerIscrizione(tokenRichiedente,
							codiceBandoIscrizione);
			risultato.setCategorie(categorie);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("categorieImpresaPerIscrizione: fine metodo");

		return risultato;
	}

	@Override
	public ImpresaIscrizioneOutType getImpresaIscrizione(
			String tokenRichiedente, String codiceBandoIscrizione) {
		LOG.debug("getImpresaIscrizione(" + tokenRichiedente
				  + "," + codiceBandoIscrizione + "): inizio metodo");

		ImpresaIscrizioneOutType risultato = new ImpresaIscrizioneOutType();

		try {
			ImpresaIscrizioneType impresa = this.bandiManager
					.getImpresaIscrizione(tokenRichiedente,
										  codiceBandoIscrizione);
			risultato.setImpresa(impresa);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getImpresaIscrizione: fine metodo");

		return risultato;
	}

	@Override
	public EsitoOutType isImpresaRegistrata(String codiceFiscale,
			String partitaIva, boolean isGruppoIva) {
		LOG.debug("isImpresaRegistrata(" + codiceFiscale + ","
				+ partitaIva + ","
				+ isGruppoIva +"): inizio metodo");

		EsitoOutType risultato = new EsitoOutType();

		try {
			Boolean impresaRegistrata = this.impreseGaraManager
					.isImpresaRegistrata(codiceFiscale, partitaIva, isGruppoIva);
			risultato.setEsito(impresaRegistrata);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("isImpresaRegistrata: fine metodo");

		return risultato;
	}
	
	@Override
	public RisultatoStringaOutType getImpresaRegistrata(
			String codiceFiscale,
			String partitaIva, 
			String email, 
			String pec) {
		LOG.debug("getImpresaRegistrata(" + codiceFiscale + ","
				+ partitaIva + "," + email + "," + pec + "): inizio metodo");

		RisultatoStringaOutType risultato = new RisultatoStringaOutType();

		try {
			String username = this.impreseGaraManager
					.getImpresaRegistrata(codiceFiscale, partitaIva, email, pec);
			risultato.setValore(username);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getImpresaRegistrata: fine metodo");

		return risultato;
	}

	@Override
	public EsitoOutType isConsorziateEsecutriciPresenti(
			String tokenRichiedente, String codiceGara) {
		LOG.debug("isConsorziateEsecutriciPresenti(" + tokenRichiedente
				+ "," + codiceGara + "): inizio metodo");

		EsitoOutType risultato = new EsitoOutType();

		try {
			Boolean consorziatePresenti = this.bandiManager
					.isConsorziateEsecutriciPresenti(tokenRichiedente,
							codiceGara);
			risultato.setEsito(consorziatePresenti);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("isConsorziateEsecutriciPresenti: fine metodo");

		return risultato;
	}

	@Override
	public GetCfgCheckPIFacoltativaOutType getCfgCheckPIFacoltativaLiberoProfessionista() {
		LOG.debug("getCfgCheckPIFacoltativaLiberoProfessionista(): inizio metodo");
		String tipologia = "1"; // configurazione per il libero professionista
		GetCfgCheckPIFacoltativaOutType risultato = getCfgCheckPIFacoltativa(tipologia);
		LOG.debug("getCfgCheckPIFacoltativaLiberoProfessionista: fine metodo");

		return risultato;
	}

	@Override
	public GetCfgCheckPIFacoltativaOutType getCfgCheckPIFacoltativaImpresaSociale() {
		LOG.debug("getCfgCheckPIFacoltativaImpresaSociale(): inizio metodo");
		String tipologia = "2"; // configurazione per una impresa sociale
		GetCfgCheckPIFacoltativaOutType risultato = getCfgCheckPIFacoltativa(tipologia);
		LOG.debug("getCfgCheckPIFacoltativaImpresaSociale: fine metodo");

		return risultato;
	}

	/**
	 * @param tipologia
	 * @return
	 */
	private GetCfgCheckPIFacoltativaOutType getCfgCheckPIFacoltativa(
			String tipologia) {
		GetCfgCheckPIFacoltativaOutType risultato = new GetCfgCheckPIFacoltativaOutType();
		try {
			List<DatoCodificatoType> lista = this.datiCodificatiManager
					.getTipiTab1("G_045");
			boolean checkPIFacoltativa = false;
			for (int i = 0; i < lista.size(); i++) {
				DatoCodificatoType configurazione = lista.get(i);
				if (tipologia.equals(configurazione.getCodice()) && configurazione.getDescrizione() != null
						&& configurazione.getDescrizione().startsWith("1")) {
					checkPIFacoltativa = true;
				}
			}
			risultato.setCheckFacoltativo(checkPIFacoltativa);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}
		return risultato;
	}

	@Override
	public ElencoBandiOutType searchBandiPerProcInAggiudicazione(GaraTypeSearch filtri) {
		LOG.debug("searchBandiPerProcInAggiudicazione({},{},{},{},{},{},{},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getTokenRichiedente(), filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getTipoAppalto(), filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA()
			, filtri.getDataScadenzaDa(), filtri.getDataScadenzaA(), filtri.getProceduraTelematica()
			, filtri.getStato(), filtri.getEsito(), filtri.getAltriSoggetti(), filtri.getSommaUrgenza()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();
		try {
			int count = bandiManager.countBandiPerProcInAggiudicazione(filtri);
			
			List<GaraType> listaGare = bandiManager.searchBandiPerProcInAggiudicazione(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("searchBandiPerProcInAggiudicazione: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType searchBandiPerProcInAggiudicazionePrivatistiche(GaraTypeSearch filtri) {
		LOG.debug("searchBandiPerProcInAggiudicazionePrivatistiche({},{},{},{},{},{},{},{},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getTokenRichiedente(), filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig()
			, filtri.getTipoAppalto(), filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA()
			, filtri.getDataScadenzaDa(), filtri.getDataScadenzaA(), filtri.getProceduraTelematica()
			, filtri.getStato(), filtri.getEsito(), filtri.getAltriSoggetti(), filtri.getSommaUrgenza(), filtri.getGaraPrivatistica()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();
		try {
			int count = this.bandiManager.countBandiPerProcInAggiudicazione(filtri);
			
			List<GaraType> listaGare = this.bandiManager.searchBandiPerProcInAggiudicazione(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("searchBandiPerProcInAggiudicazionePrivatistiche: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiOutType searchBandiConEsito(GaraTypeSearch filtri) {
		LOG.debug("searchBandiConEsito({},{},{},{},{},{},{},{},{},{},{},{},{}): inizio metodo"
			, filtri.getStazioneAppaltante(), filtri.getOggetto(), filtri.getCig(), filtri.getTipoAppalto()
			, filtri.getDataPubblicazioneDa(), filtri.getDataPubblicazioneA(), filtri.getDataScadenzaDa()
			, filtri.getDataScadenzaA(), filtri.getProceduraTelematica(), filtri.getStato()
			, filtri.getAltriSoggetti(), filtri.getSommaUrgenza(), filtri.getNumAnniPubblicazione()
		);

		ElencoBandiOutType risultato = new ElencoBandiOutType();
		try {
			int count = bandiManager.countBandiConEsito(filtri);

			List<GaraType> listaGare = bandiManager.searchBandiConEsito(filtri);
			risultato.setElencoBandi(listaGare);
			risultato.setNumBandi(count);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("searchBandiConEsito: fine metodo");

		return risultato;
	}

	@Override
	public ElencoBandiIscrizioneOutType searchCataloghi(String token,
			Integer stato, String stazioneAppaltante, Boolean isAttivo) {
		LOG.debug("searchCataloghi(" + token + "," + stato + "," + stazioneAppaltante
				+ "): inizio metodo");

		ElencoBandiIscrizioneOutType risultato = new ElencoBandiIscrizioneOutType();
		try {
			List<BandoIscrizioneType> listaElementi = this.cataloghiManager
					.searchCataloghi(token, stato, stazioneAppaltante, isAttivo);
			risultato.setElencoBandiIscrizione(listaElementi);
			risultato.setNumBandi(listaElementi.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("searchCataloghi: fine metodo");
		return risultato;
	}

	@Override
	public ElencoBandiIscrizioneOutType getElencoCataloghi(String stazioneAppaltante, Boolean isAttivo) {
		LOG.debug("elencoCataloghi(" + stazioneAppaltante + "): inizio metodo");

		ElencoBandiIscrizioneOutType risultato = new ElencoBandiIscrizioneOutType();
		try {
			List<BandoIscrizioneType> listaElementi = this.cataloghiManager
					.getElencoCataloghi(stazioneAppaltante, isAttivo);
			risultato.setElencoBandiIscrizione(listaElementi);
			risultato.setNumBandi(listaElementi.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("elencoCataloghi: fine metodo");
		return risultato;
	}

	@Override
	public DettaglioBandoIscrizioneOutType getDettaglioCatalogo(
			String codiceCatalogo) {
		LOG.debug("dettaglioCatalogo(" + codiceCatalogo
				+ "): inizio metodo");

		DettaglioBandoIscrizioneOutType risultato = this
				.getDettaglioBandoIscrizione(codiceCatalogo, null);
		LOG.debug("dettaglioCatalogo: fine metodo");
		return risultato;
	}

	@Override
	public SearchArticoliOutType searchArticoli(
			String codiceCatalogo,
			String tokenRichiedente, 
			String codiceCategoria, 
			String codice,
			String tipo, 
			String descrizione, 
			String colore,
			int indicePrimoRecord, int maxNumRecord) {
		LOG.debug("searchArticoli(" + codiceCatalogo + ","
				+ tokenRichiedente + "," + codiceCategoria + "," + ","
				+ codice + tipo + "," + descrizione + "," + colore + ","
				+ indicePrimoRecord + "," + maxNumRecord
				+ "): inizio metodo");

		SearchArticoliOutType risultato = new SearchArticoliOutType();

		try {
			risultato.setNumElementiTotali(this.cataloghiManager
					.countSearchArticoli(codiceCatalogo, tokenRichiedente, null, null, null,
							null, null));
			risultato.setNumElementiTotaliFiltrati(this.cataloghiManager
					.countSearchArticoli(codiceCatalogo, tokenRichiedente, codiceCategoria,
							codice, tipo, descrizione, colore));
			List<ArticoloType> listaElementi = this.cataloghiManager
					.searchArticoli(codiceCatalogo, tokenRichiedente, codiceCategoria, codice,
							tipo, descrizione, colore, 
							indicePrimoRecord, maxNumRecord);
			risultato.setElencoArticoli(listaElementi);
		} catch (DataAccessException e) {
			LOG.error(
					"Errore inaspettato durante l'interazione con la base dati",
					e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("searchArticoli: fine metodo");

		return risultato;
	}

	@Override
	public GetArticoloOutType getArticolo(long id) {
		LOG.debug("articolo(" + id + "): inizio metodo");

		GetArticoloOutType risultato = new GetArticoloOutType();
		try {
			ArticoloType dettaglio = this.cataloghiManager.getArticolo(id);
			
			// carica l'elenco dei fac simile certificati (tipo=1)
			// e l'elenco degli altri documenti (tipo=2)
			List<DocumentoAllegatoType> facsimilecert = this.cataloghiManager
					.getDocumentiArticolo(id, 1);
			List<DocumentoAllegatoType> documenti = this.cataloghiManager
					.getDocumentiArticolo(id, 2);
			
			risultato.setArticolo(dettaglio);
			dettaglio.setFacSimileCertificazioni(facsimilecert);
			dettaglio.setDocumentiUlteriori(documenti);

		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("articolo: fine metodo");
		return risultato;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiArticolo()
	 */
	@Override
	public String getElencoTipiArticolo() {
		LOG.debug("elencoTipiArticolo: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("ME001");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoTipiArticolo: fine metodo");
		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoTipiPrezzoArticoloRiferitoA()
	 */
	@Override
	public String getElencoTipiPrezzoArticoloRiferitoA() {
		LOG.debug("elencoPrezzoArticoloRiferitoA: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("ME003");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoPrezzoArticoloRiferitoA: fine metodo");
		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoUnitaMisura()
	 */
	@Override
	public String getElencoUnitaMisura() {
		LOG.debug("elencoUnitaMisura: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("ME007");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoUnitaMisura: fine metodo");
		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoUnitaMisuraTempoConsegna()
	 */
	@Override
	public String getElencoUnitaMisuraTempoConsegna() {
		LOG.debug("elencoUnitaMisuraTempoConsegna: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("ME004");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoUnitaMisuraTempoConsegna: fine metodo");
		return documentoXML;
	}

	/* (non-Javadoc)
	 * @see it.maggioli.eldasoft.sil.gare.bl.IGareAppaltoFacade#getElencoStatiProdotto()
	 */
	@Override
	public String getElencoStatiProdotto() {
		LOG.debug("elencoStatiProdotto: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("ME005");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("elencoStatiProdotto: fine metodo");
		return documentoXML;
	}

	@Override
	public RisultatoNumericoOutType getNumProdottiOEInArticolo(long idArticolo,
			String tokenRichiedente) {
		LOG.debug("getNumProdottiOEInArticolo(" + idArticolo + ","
				+ tokenRichiedente + "): inizio metodo");

		RisultatoNumericoOutType risultato = new RisultatoNumericoOutType();
		try {
			Long num = this.cataloghiManager.getNumProdottiOEInArticolo(
					idArticolo, tokenRichiedente);
			risultato.setValore(num);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getNumProdottiOEInArticolo: fine metodo");
		return risultato;

	}

	@Override
	public RisultatoNumericoOutType getNumProdottiAltriOEInArticolo(
			long idArticolo, String tokenRichiedente) {
		LOG.debug("getNumProdottiAltriOEInArticolo(" + idArticolo + ","
				+ tokenRichiedente + "): inizio metodo");

		RisultatoNumericoOutType risultato = new RisultatoNumericoOutType();
		try {
			Long num = this.cataloghiManager.getNumProdottiAltriOEInArticolo(
					idArticolo, tokenRichiedente);
			risultato.setValore(num);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getNumProdottiAltriOEInArticolo: fine metodo");
		return risultato;
	}

	@Override
	public RisultatoDecimaleOutType getPrezzoMiglioreArticolo(long idArticolo) {
		LOG.debug("getPrezzoMiglioreArticolo(" + idArticolo
				+ "): inizio metodo");

		RisultatoDecimaleOutType risultato = new RisultatoDecimaleOutType();
		try {
			Double num = this.cataloghiManager
					.getPrezzoMiglioreArticolo(idArticolo);
			risultato.setValore(num);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getPrezzoMiglioreArticolo: fine metodo");
		return risultato;
	}

	@Override
	public EsitoOutType isImpresaAbilitataCatalogo(String codiceCatalogo,
			String tokenRichiedente) {
		LOG.debug("isImpresaAbilitataCatalogo(" + codiceCatalogo + ","
				+ tokenRichiedente + "): inizio metodo");

		EsitoOutType risultato = new EsitoOutType();
		try {
			Boolean esito = this.cataloghiManager.isImpresaAbilitataCatalogo(
					codiceCatalogo, tokenRichiedente);
			risultato.setEsito(esito);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("isImpresaAbilitataCatalogo: fine metodo");
		return risultato;
	}

	@Override
	public EsitoOutType isImpresaAbilitataRinnovo(String codiceBandoIscrizione,
			String tokenRichiedente) {
		LOG.debug("isImpresaAbilitataRinnovo(" + codiceBandoIscrizione + ","
				+ tokenRichiedente + "): inizio metodo");

		EsitoOutType risultato = new EsitoOutType();
		try {
			Boolean esito = this.bandiManager.isImpresaAbilitataRinnovo(
					codiceBandoIscrizione, tokenRichiedente);
			risultato.setEsito(esito);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("isImpresaAbilitataRinnovo: fine metodo");
		return risultato;
	}

	@Override
	public SearchProdottiOutType searchProdotti(String codiceCatalogo,
			Long idArticolo, 
			String tokenRichiedente, 
			String terminiRicerca,
			int indicePrimoRecord, int maxNumRecord) {
		LOG.debug("searchProdotti(" + codiceCatalogo + "," + idArticolo
				+ "," + tokenRichiedente + "," + terminiRicerca + ","
				+ indicePrimoRecord + "," + maxNumRecord
				+ "): inizio metodo");

		SearchProdottiOutType risultato = new SearchProdottiOutType();

		try {
			int numElementi = this.cataloghiManager.countSearchProdotti(
					codiceCatalogo, idArticolo, tokenRichiedente, null);
			risultato.setNumElementiTotali(numElementi);
			if (numElementi > 0) {
				int numElementiFiltrati = this.cataloghiManager
						.countSearchProdotti(codiceCatalogo, idArticolo,
								tokenRichiedente, terminiRicerca);
				risultato.setNumElementiTotaliFiltrati(numElementiFiltrati);
				if (numElementiFiltrati > 0) {
					List<ProdottoType> listaElementi = this.cataloghiManager
							.searchProdotti(codiceCatalogo, idArticolo,
									tokenRichiedente, terminiRicerca,
									indicePrimoRecord, maxNumRecord);
					risultato.setElencoProdotti(listaElementi);
				} else {
					// se la count non estrae elementi, mi risparmio la query
					// per estrarre gli elementi
					risultato.setElencoProdotti(new ArrayList<ProdottoType>());
				}
			} else {
				// se non si estraggono elementi, mi risparmio le query
				// successive indicando 0 elementi
				risultato.setNumElementiTotaliFiltrati(0);
				risultato.setElencoProdotti(new ArrayList<ProdottoType>());
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}
		LOG.debug("searchProdotti: fine metodo");

		return risultato;
	}

	@Override
	public SearchProdottiOutType advancedSearchProdotti(
			String codiceCatalogo,
			Long idArticolo, 
			String tokenRichiedente, 
			String tipoArticolo,
			String descrizioneArticolo, 
			String coloreArticolo,
			String codiceProdottoFornitore, 
			String nomeCommerciale,
			String descrizioneAggiuntiva, 
			String statoProdotto,
			int indicePrimoRecord, int maxNumRecord) {
		LOG.debug("searchProdotti(" + codiceCatalogo + "," + idArticolo
				+ "," + tokenRichiedente + "," + tipoArticolo + ","
				+ descrizioneArticolo + "," + coloreArticolo + ","
				+ codiceProdottoFornitore + "," + nomeCommerciale + ","
				+ descrizioneAggiuntiva + "," + statoProdotto + ","
				+ indicePrimoRecord + "," + maxNumRecord
				+ "): inizio metodo");

		SearchProdottiOutType risultato = new SearchProdottiOutType();

		try {
			int numElementi = this.cataloghiManager
					.countAdvancedSearchProdotti(codiceCatalogo, idArticolo,
							tokenRichiedente, null, null, null, null, null,
							null, null);
			risultato.setNumElementiTotali(numElementi);
			if (numElementi > 0) {
				int numElementiFiltrati = this.cataloghiManager
						.countAdvancedSearchProdotti(codiceCatalogo,
								idArticolo, tokenRichiedente, tipoArticolo,
								descrizioneArticolo, coloreArticolo,
								codiceProdottoFornitore, nomeCommerciale,
								descrizioneAggiuntiva, statoProdotto);
				risultato.setNumElementiTotaliFiltrati(numElementiFiltrati);
				if (numElementiFiltrati > 0) {
					List<ProdottoType> listaElementi = this.cataloghiManager
							.advancedSearchProdotti(codiceCatalogo, idArticolo,
									tokenRichiedente, tipoArticolo,
									descrizioneArticolo, coloreArticolo,
									codiceProdottoFornitore, nomeCommerciale,
									descrizioneAggiuntiva, statoProdotto,
									indicePrimoRecord, maxNumRecord);
					risultato.setElencoProdotti(listaElementi);
				} else {
					// se la count non estrae elementi, mi risparmio la query
					// per estrarre gli elementi
					risultato.setElencoProdotti(new ArrayList<ProdottoType>());
				}
			} else {
				// se non si estraggono elementi, mi risparmio le query
				// successive indicando 0 elementi
				risultato.setNumElementiTotaliFiltrati(0);
				risultato.setElencoProdotti(new ArrayList<ProdottoType>());
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}
		LOG.debug("searchProdotti: fine metodo");

		return risultato;
	}

	@Override
	public GetProdottoOutType getProdotto(long id) {
		LOG.debug("prodotto(" + id + "): inizio metodo");

		GetProdottoOutType risultato = new GetProdottoOutType();
		try {
			ProdottoType dettaglio = this.cataloghiManager.getProdotto(id);
			DocumentoAllegatoType immagine = this.cataloghiManager
					.getImmagine(id);
			List<DocumentoAllegatoType> certificazioni = this.cataloghiManager
					.getCertificazioni(id);
			List<DocumentoAllegatoType> schedeTecniche = this.cataloghiManager
					.getSchedeTecniche(id);

			dettaglio.setImmagine(immagine);
			if (certificazioni != null) {
				dettaglio.setCertificazioniRichieste(certificazioni);
			}
			if (schedeTecniche != null) {
				dettaglio.setSchedeTecniche(schedeTecniche);
			}
			risultato.setProdotto(dettaglio);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("prodotto: fine metodo");
		return risultato;
	}

	@Override
	public GetCategorieArticoliOEOutType getCategorieArticoliOE(
			String codiceCatalogo, String tokenRichiedente) {
		LOG.debug("getCategorieArticoliOE(" + codiceCatalogo + ","
				+ tokenRichiedente + "): inizio metodo");

		GetCategorieArticoliOEOutType risultato = new GetCategorieArticoliOEOutType();
		try {
			List<CategoriaCatalogoType> categorie = this.cataloghiManager
					.getCategorieArticoliOE(codiceCatalogo, tokenRichiedente);
			risultato.setCategorie(categorie);
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getCategorieArticoliOE: fine metodo");
		return risultato;
	}

	@Override
	public ElencoContrattiOutType searchContratti(
			String stazioneAppaltante,
			String oggetto, 
			String cig, 
			String stato, 
			String tokenRichiedente) {
		LOG.debug("searchContratti(" + stazioneAppaltante + "," + oggetto
				+ "," + cig + "," + stato + ","
				+ tokenRichiedente
				+ "): inizio metodo");

		ElencoContrattiOutType risultato = new ElencoContrattiOutType();

		try {
			List<ContrattoType> lista = this.contrattiManager.searchContratti(
					stazioneAppaltante, 
					oggetto, 
					cig, 
					stato,
					tokenRichiedente);
			risultato.setElenco(lista);
			risultato.setNum(lista.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("searchContratti: fine metodo");

		return risultato;
	}

	@Override
	public GetDettaglioContrattoOutType getDettaglioContratto(String codice) {
		LOG.debug("getDettaglioContratto(" + codice + "): inizio metodo");

		GetDettaglioContrattoOutType risultato = new GetDettaglioContrattoOutType();

		try {
			ContrattoType dettaglio = this.contrattiManager
					.getDettaglioContratto(codice);
			risultato.setContratto(dettaglio);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getDettaglioContratto: fine metodo");

		return risultato;
	}

	@Override
	public GetVociDettaglioOffertaOutType getVociDettaglioOfferta(String codice) {
		LOG.debug("vociDettaglioOfferta(" + codice + "): inizio metodo");

		GetVociDettaglioOffertaOutType risultato = new GetVociDettaglioOffertaOutType();

		try {
			List<VoceDettaglioOffertaType> lista = this.bandiManager
					.getVociDettaglioOfferta(codice);
			risultato.setElenco(lista);
			risultato.setNum(lista.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("vociDettaglioOfferta: fine metodo");

		return risultato;
	}

	@Override
	public GetVociDettaglioOffertaOutType getVociDettaglioOffertaNoRibasso(String codice) {
		LOG.debug("vociDettaglioOffertaNoRibasso(" + codice + "): inizio metodo");

		GetVociDettaglioOffertaOutType risultato = new GetVociDettaglioOffertaOutType();

		try {
			List<VoceDettaglioOffertaType> lista = this.bandiManager
					.getVociDettaglioOffertaNoRibasso(codice);
			risultato.setElenco(lista);
			risultato.setNum(lista.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("vociDettaglioOffertaNoRibasso: fine metodo");

		return risultato;
	}

	@Override
	public GetAttributiAggiuntiviOffertaOutType getAttributiAggiuntiviOfferta(
			String codice) {
		LOG.debug("attributiAggiuntiviOfferta(" + codice
				+ "): inizio metodo");

		GetAttributiAggiuntiviOffertaOutType risultato = new GetAttributiAggiuntiviOffertaOutType();

		try {
			List<AttributoAggiuntivoOfferta> lista = this.bandiManager
					.getAttributiAggiuntiviOfferta(codice);
			List<AttributoAggiuntivoOffertaType> listaConTabellati = new ArrayList<AttributoAggiuntivoOffertaType>();
			for (AttributoAggiuntivoOfferta attributo : lista) {
				if (attributo.getTipo() == 3) {
					// nel caso di campo tabellato si estraggono i valori ammessi nel dominio
					List<DatoCodificatoType> datiCodificati = this.datiCodificatiManager
							.getTipiTab1(attributo.getTabellato());
					if (datiCodificati.size() == 0) {
						datiCodificati = this.datiCodificatiManager
								.getTipiTab3(attributo.getTabellato());
					}
					String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(datiCodificati);
					attributo.setValoriAmmessi(documentoXML);
				}
				listaConTabellati.add(attributo);
			}

			risultato.setElenco(listaConTabellati);
			risultato.setNum(lista.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("attributiAggiuntiviOfferta: fine metodo");

		return risultato;
	}

	@Override
	public GetDettaglioStazioneAppaltanteOutType getDettaglioStazioneAppaltante(
			String codice) {
		LOG.debug("dettaglioStazioneAppaltante(" + codice + "): inizio metodo");

		GetDettaglioStazioneAppaltanteOutType risultato = new GetDettaglioStazioneAppaltanteOutType();

		try {
			DettaglioStazioneAppaltanteType dettaglio = this.bandiManager
					.getDettaglioStazioneAppaltante(codice);
			risultato.setStazioneAppaltante(dettaglio);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("dettaglioStazioneAppaltante: fine metodo");

		return risultato;
	}
	
	@Override
	public GetStazioniAppaltantiOutType getStazioniAppaltanti() {
		LOG.debug("getStazioniAppaltanti(): inizio metodo");

		GetStazioniAppaltantiOutType risultato = new GetStazioniAppaltantiOutType();

		try {
			List<DettaglioStazioneAppaltanteType> elenco = this.bandiManager
					.getStazioniAppaltanti();
			risultato.setElenco(elenco);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getStazioniAppaltanti: fine metodo");

		return risultato;
	}

	@Override
	public RisultatoNumericoOutType getNumDecimaliRibasso() {
		LOG.debug("getNumDecimaliRibasso: inizio metodo");

		RisultatoNumericoOutType risultato = new RisultatoNumericoOutType();
		try {
			List<DatoCodificatoType> lista = this.datiCodificatiManager
					.getTipiTab1("A1028");
			Long num = null;
			if (lista.size() > 0) {
				String strNumDecimali = lista.get(0).getDescrizione();
				num = Long.parseLong(strNumDecimali);
			}
			risultato.setValore(num);
		} catch (NumberFormatException e) {
			// strano, non dovrebbe accadere mai
			LOG.error("Errore di interpretazione del numero decimali nel tabellato A1028", e);
			risultato.setErrore(e.getMessage());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getNumDecimaliRibasso: fine metodo");
		return risultato;
	}

	@Override
	public GetMandantiRTIOutType getMandantiRTI(
			String codiceProcedura,
			String tokenMandataria,
			String progOfferta) {
		LOG.debug("getMandantiRTI(" + codiceProcedura + ", "
				+ tokenMandataria + ", " + progOfferta + "): inizio metodo");

		GetMandantiRTIOutType risultato = new GetMandantiRTIOutType();

		try {
			List<MandanteRTIType> lista = this.bandiManager
					.getMandantiRTI(codiceProcedura, tokenMandataria, progOfferta);
			risultato.setElenco(lista);
			risultato.setNum(lista.size());
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getMandantiRTI: fine metodo");

		return risultato;
	}

	@Override
	public GetFascicoloProtocolloOutType getFascicoloProtocollo(String codice) {
		LOG.debug("getFascicoloProtocollo(" + codice
				+ "): inizio metodo");

		GetFascicoloProtocolloOutType risultato = new GetFascicoloProtocolloOutType();
		try {
			FascicoloProtocolloType fascicolo = this.bandiManager
					.getFascicoloProtocollo(codice);
			risultato.setFascicolo(fascicolo);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getFascicoloProtocollo: fine metodo");
		return risultato;
	}

	@Override
	public RisultatoNumericoOutType getGenere(String codice) {
		LOG.debug("getGenere(" +codice  + "): inizio metodo");

		RisultatoNumericoOutType risultato = new RisultatoNumericoOutType();
		try {
			Long num = this.bandiManager.getGenere(codice);
			risultato.setValore(num);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getGenere: fine metodo");
		return risultato;
	}

	@Override
	public RisultatoStringaOutType getChiavePubblica(String codice, String tipo) {
		LOG.debug("getChiavePubblica(" + codice + "," + tipo
				+ "): inizio metodo");

		RisultatoStringaOutType risultato = new RisultatoStringaOutType();
		try {
			String chiave = this.bandiManager.getChiavePubblica(codice, tipo);
			risultato.setValore(chiave);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getChiavePubblica: fine metodo");
		return risultato;
	}

	@Override
	public GetAttiDocumentiBandoGaraOutType getAttiDocumentiBandoGara(String codiceGara){
		LOG.debug("getAttiDocumentiBandoGara(" + codiceGara + "): inizio metodo");

		GetAttiDocumentiBandoGaraOutType risultato = new GetAttiDocumentiBandoGaraOutType();
		try {
			List<DocumentoAllegatoType> attiDocumenti = this.bandiManager.getAttiDocumentiBandoGara(codiceGara);
			risultato.setAttiDocumenti(attiDocumenti);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getAttiDocumentiBandoGara: fine metodo");
		return risultato;
	}

	@Override
    public GetDocumentiInvitoAstaLottoOutType getDocumentiInvitoAstaLotto(
    	    String codiceGara, String codiceLotto) {
		LOG.debug("getDocumentiInvitoAstaLotto(" + codiceGara + "," + codiceLotto +"): inizio metodo");

		GetDocumentiInvitoAstaLottoOutType risultato = new GetDocumentiInvitoAstaLottoOutType();
		try {
			List<DocumentoAllegatoType> elenco = this.bandiManager
				.getDocumentiInvitoAstaLotto(codiceGara, codiceLotto);
			risultato.setElenco(elenco);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getDocumentiInvitoAstaLotto: fine metodo");
		return risultato;
	}

	
	@Override
	public java.lang.Boolean isInvitataAsta(
    	    String codiceGara, String username) {
		LOG.debug("isInvitataAsta(" + codiceGara + "," + username +"): inizio metodo");

		Boolean risultato = new Boolean(false);
		try {
			Boolean res = this.bandiManager.isInvitataAsta(codiceGara, username);
			risultato = (res != null && res);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			//risultato.setErrore(e.getMessage());
		}

		LOG.debug("isInvitataAsta: fine metodo");
		return risultato;
	}
	
	@Override
	public CheckAggiornamentoIscrizionePosticipataOutType checkAggiornamentoIscrizionePosticipata(
    	    String tokenRichiedente, String codiceGara) {
		LOG.debug("checkAggiornamentoIscrizionePosticipata(" + codiceGara + "," + tokenRichiedente +"): inizio metodo");

		CheckAggiornamentoIscrizionePosticipataOutType risultato = new CheckAggiornamentoIscrizionePosticipataOutType();
		try {
			Long res = this.bandiManager
				.checkAggiornamentoIscrizionePosticipata(tokenRichiedente, codiceGara);
			risultato.setRisultato(res);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("checkAggiornamentoIscrizionePosticipata: fine metodo");
		return risultato;
	}

	@Override
	public GetEspletamentoGaraElencoOperatoriOutType getEspletamentoGaraSoccorsiElencoOperatori(
			String codiceGara, String codiceLotto, String fase, String tokenRichiedente) throws DataAccessException {
		LOG.debug("getEspletamentoGaraSoccorsiElencoOperatori(" +
				codiceGara + "," + codiceLotto + "," + fase + "," + tokenRichiedente +"): inizio metodo");

		GetEspletamentoGaraElencoOperatoriOutType risultato = new GetEspletamentoGaraElencoOperatoriOutType();
		try {
			List<EspletGaraOperatoreType> elenco = 
				(List<EspletGaraOperatoreType>) this.bandiManager
					.getEspletamentoGaraSoccorsiElencoOperatori(codiceGara, codiceLotto, fase, tokenRichiedente);
			risultato.setElenco(elenco);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getEspletamentoGaraSoccorsiElencoOperatori: fine metodo");
		
		return risultato;
	}
	
	@Override
	public GetEspletamentoGaraElencoOperatoriOutType getEspletamentoGaraDocAmmElencoOperatori(
			String codiceGara, String tokenRichiedente) throws DataAccessException {
		LOG.debug("getEspletamentoGaraDocAmmElencoOperatori(" + codiceGara + "," + tokenRichiedente +"): inizio metodo");

		GetEspletamentoGaraElencoOperatoriOutType risultato = new GetEspletamentoGaraElencoOperatoriOutType();
		try {
			List<EspletGaraOperatoreType> elenco = 
				(List<EspletGaraOperatoreType>) this.bandiManager
					.getEspletamentoGaraDocAmmElencoOperatori(codiceGara, tokenRichiedente);
			risultato.setElenco(elenco);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getEspletamentoGaraDocAmmElencoOperatori: fine metodo");
		
		return risultato;
	}
	
	@Override
	public GetEspletamentoGaraElencoOperatoriOutType getEspletamentoGaraValTecElencoOperatori(
			String codice, String codiceLotto, String tokenRichiedente) throws DataAccessException {
		LOG.debug("getEspletamentoGaraValTecElencoOperatori(" + codice + "," + codiceLotto + "," + tokenRichiedente +"): inizio metodo");

		GetEspletamentoGaraElencoOperatoriOutType risultato = new GetEspletamentoGaraElencoOperatoriOutType();
		try {
			List<EspletGaraOperatoreType> elenco = 
				(List<EspletGaraOperatoreType>) this.bandiManager
					.getEspletamentoGaraValTecElencoOperatori(codice, codiceLotto, tokenRichiedente);
			risultato.setElenco(elenco);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getEspletamentoGaraValTecElencoOperatori: fine metodo");
		
		return risultato;
	}

	@Override
	public GetEspletamentoGaraElencoOperatoriOutType getEspletamentoGaraValTecElencoOperatoriLotto(
			String codice, String tokenRichiedente) throws DataAccessException {
		LOG.debug("getEspletamentoGaraValTecElencoOperatoriLotto(" + codice + "," + tokenRichiedente +"): inizio metodo");

		GetEspletamentoGaraElencoOperatoriOutType risultato = new GetEspletamentoGaraElencoOperatoriOutType();
		try {
			List<EspletGaraOperatoreType> elenco = 
				(List<EspletGaraOperatoreType>) this.bandiManager
					.getEspletamentoGaraValTecElencoOperatoriLotto(codice, tokenRichiedente);
			risultato.setElenco(elenco);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getEspletamentoGaraValTecElencoOperatoriLotto: fine metodo");
		
		return risultato;
	}
	
	@Override
	public GetEspletamentoGaraElencoOperatoriOutType getEspletamentoGaraOffEcoElencoOperatori(
			String codice, String codiceLotto, String tokenRichiedente) throws DataAccessException {
		LOG.debug("getEspletamentoGaraOffEcoElencoOperatori(" + codice + "," + codiceLotto + "," + tokenRichiedente +"): inizio metodo");

		GetEspletamentoGaraElencoOperatoriOutType risultato = new GetEspletamentoGaraElencoOperatoriOutType();
		try {
			List<EspletGaraOperatoreType> elenco = 
				(List<EspletGaraOperatoreType>) this.bandiManager
					.getEspletamentoGaraOffEcoElencoOperatori(codice, codiceLotto, tokenRichiedente);
			risultato.setElenco(elenco);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getEspletamentoGaraOffEcoElencoOperatori: fine metodo");
		
		return risultato;
	}

	@Override
	public GetEspletamentoGaraElencoOperatoriOutType getEspletamentoGaraOffEcoElencoOperatoriLotto(
			String codice, String tokenRichiedente) throws DataAccessException {
		LOG.debug("getEspletamentoGaraOffEcoElencoOperatoriLotto(" + codice + "," + tokenRichiedente +"): inizio metodo");

		GetEspletamentoGaraElencoOperatoriOutType risultato = new GetEspletamentoGaraElencoOperatoriOutType();
		try {
			List<EspletGaraOperatoreType> elenco = 
				(List<EspletGaraOperatoreType>) this.bandiManager
					.getEspletamentoGaraOffEcoElencoOperatoriLotto(codice, tokenRichiedente);
			risultato.setElenco(elenco);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getEspletamentoGaraOffEcoElencoOperatoriLotto: fine metodo");
		
		return risultato;
	}

	@Override
	public GetEspletamentoGaraElencoOperatoriOutType getEspletamentoGaraGraduatoriaElencoOperatori(
			String codiceGara, String tokenRichiedente) throws DataAccessException {
		LOG.debug("getEspletamentoGaraGraduatoriaElencoOperatori(" + codiceGara + "," + tokenRichiedente +"): inizio metodo");

		GetEspletamentoGaraElencoOperatoriOutType risultato = new GetEspletamentoGaraElencoOperatoriOutType();
		try {
			List<EspletGaraOperatoreType> elenco = 
				(List<EspletGaraOperatoreType>) this.bandiManager
					.getEspletamentoGaraGraduatoriaElencoOperatori(codiceGara, tokenRichiedente);
			risultato.setElenco(elenco);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("getEspletamentoGaraGraduatoriaElencoOperatori: fine metodo");
		
		return risultato;
	}
	
	@Override
	public RisultatoNumericoOutType getFaseGara(String codice) {
		LOG.debug("getFaseGara(" +codice  + "): inizio metodo");

		RisultatoNumericoOutType risultato = new RisultatoNumericoOutType();
		try {
			Long faseGara = this.bandiManager.getFaseGara(codice);
			risultato.setValore(faseGara);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getFaseGara: fine metodo");
		return risultato;
	}
	
	@Override
	public it.maggioli.eldasoft.sil.gare.ws.ComunicazioniPersonaliOutType getNews(
			int indicePrimoRecord, int maxNumRecord, 
			String stazioneAppaltante) throws DataAccessException {
		LOG.debug("getNews(): inizio metodo");

		ComunicazioniPersonaliOutType risultato = new ComunicazioniPersonaliOutType();
		try {
			risultato.setNumElementiTotali(this.bandiManager.countNews(stazioneAppaltante)); 
	
			if (risultato.getNumElementiTotali() > 0) {				
				List<ComunicazioneType> comunicazioni = (List<ComunicazioneType>)this.bandiManager
					.getNews(indicePrimoRecord, maxNumRecord, stazioneAppaltante);
				risultato.setComunicazione(comunicazioni);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getNews: fine metodo");
		return risultato;		
	}
	
//	@Override
//	public it.maggioli.eldasoft.sil.gare.ws.SoggettiAderentiOutType getSoggettiAderenti(
//			String codiceGara) {
//		LOG.debug("getSoggettiAderenti(codiceGara=" + codiceGara + "): inizio metodo");
//
//		SoggettiAderentiOutType risultato = new SoggettiAderentiOutType();
//		try {
//			List<SoggettoAderenteType> soggetti = (List<SoggettoAderenteType>)this.bandiManager
//				.getSoggettiAderenti(codiceGara);
//			risultato.setSoggetti(soggetti);
//			
//		} catch (DataAccessException e) {
//			LOG.error(
//					"Errore inaspettato durante l'interazione con la base dati",
//					e);
//			risultato.setErrore(e.getMessage());
//		}
//
//		LOG.debug("getSoggettiAderenti: fine metodo");
//		return risultato;		
//	}

	@Override
	public it.maggioli.eldasoft.sil.gare.ws.OperatoriIscrittiOutType getOperatoriIscritti(
			String codiceGara) {
		LOG.debug("getOperatoriIscritti(codiceGara=" + codiceGara + "): inizio metodo");

		OperatoriIscrittiOutType risultato = new OperatoriIscrittiOutType();
		try {
			List<OperatoreIscrittoType> operatori = (List<OperatoreIscrittoType>)this
				.bandiManager
					.getOperatoriIscritti(codiceGara);
			risultato.setOperatori(operatori);
			
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getOperatoriIscritti: fine metodo");
		return risultato;		
	}

	@Override
	public it.maggioli.eldasoft.sil.gare.ws.CategorieOperatoriIscrittiOutType getElencoCategorieOperatoriIscritti(
			String codiceGara) {
		LOG.debug("getElencoCategorieOperatoriIscritti(codiceGara=" + codiceGara + "): inizio metodo");

		CategorieOperatoriIscrittiOutType risultato = new CategorieOperatoriIscrittiOutType();
		try {
			List<CategoriaOperatoreIscrittoType> categorie = (List<CategoriaOperatoreIscrittoType>)this
				.bandiManager.getElencoCategorieOperatoriIscritti(codiceGara);
			risultato.setCategorie(categorie);
			
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getElencoCategorieOperatoriIscritti: fine metodo");
		return risultato;		
	}

	/* 
	 * 
	 */
	@Override
	public String getElencoSezioniIscrizioneWhitelistAntimafia() {
		LOG.debug("getElencoSezioniIscrizioneWhitelistAntimafia: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_061");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("getElencoSezioniIscrizioneWhitelistAntimafia: fine metodo");

		return documentoXML;
	}
	
	/* 
	 * 
	 */
	@Override
	public String getElencoRatingLegale() {
		LOG.debug("getElencoRatingLegale: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_069");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("getElencoRatingLegale: fine metodo");

		return documentoXML;
	}

	/* 
	 * 
	 */
	@Override
	public String getElencoClassificazioneDimensioniDipendente() {
		LOG.debug("getElencoClassificazioneDimensioniDipendente: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_062");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("getElencoClassificazioneDimensioniDipendente: fine metodo");

		return documentoXML;
	}

	/* 
	 * 
	 */
	@Override
	public String getElencoSettoriAttivitaEconomica() {
		LOG.debug("getElencoSettoriAttivitaEconomica: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab5("G_j07");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("getElencoSettoriAttivitaEconomica: fine metodo");

		return documentoXML;
	}
	
	/*
	 * 
	 */
	@Override
	public String getElencoAltriSoggetti() {
		LOG.debug("getElencoAltriSoggetti: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A1120");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);
		
		LOG.debug("getElencoAltriSoggetti: fine metodo");

		return documentoXML;
	}

	/** 
	 * 
	 */
	@Override
	public String getTipiRaggruppamento() {
		LOG.debug("getTipiRaggruppamento: inizio metodo");

//		//********************************************************************
//		// LISTA TEMPORANEA PER DEBUG DA SOSTITUIRE CON RELATIVO TABELLATO !!!
//		DatoCodificatoType test1 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test2 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test3 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test4 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test5 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test6 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test7 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test8 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test9 = DatoCodificatoType.Factory.newInstance();
//		DatoCodificatoType test10 = DatoCodificatoType.Factory.newInstance();
//		
//		test1.setCodice("1"); 	test1.setDescrizione("Consorzio di società cooperative (art.45 c.2 lettera b )"); 
//		test2.setCodice("2"); 	test2.setDescrizione("Consorzio stabile (art 45 c2 lettera c)");
//		test3.setCodice("3"); 	test3.setDescrizione("RTI costituito (art 45 c2 lettera d)");
//		test4.setCodice("4"); 	test4.setDescrizione("RTI costituendo (art 45 c2 lettera d)");
//		test5.setCodice("5"); 	test5.setDescrizione("Consorzio ordinario costituito (art.45 c.2 lettera e )");
//		test6.setCodice("6"); 	test6.setDescrizione("Consorzio ordinario costituendo (art.45 c.2 lettera e )");
//		test7.setCodice("7"); 	test7.setDescrizione("Rete d'impresa con soggettività giuridica (art. 45 c2 lettera f)");
//		test8.setCodice("8"); 	test8.setDescrizione("Rete d'impresa senza soggettività giuridica (art. 45 c2 lettera f)");
//		test9.setCodice("9"); 	test9.setDescrizione("GEIE costituito (art 45 c2 lettera g)");
//		test10.setCodice("10");	test10.setDescrizione("GEIE costituendo (art 45 c2 lettera g)");
//		
//		List<DatoCodificatoType> lista = new ArrayList<DatoCodificatoType>();
//		lista.add( test1 );
//		lista.add( test2 );
//		lista.add( test3 );
//		lista.add( test4 );
//		lista.add( test5 );
//		lista.add( test6 );
//		lista.add( test7 );
//		lista.add( test8 );
//		lista.add( test9 );
//		lista.add( test10 );
//		//********************************************************************

//		List<DatoCodificatoType> lista = this.datiCodificatiManager
//			.getTipiTab1("Ag008");
		List<DatoCodificatoType> lista = new ArrayList<DatoCodificatoType>();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);
		
		LOG.debug("getTipiRaggruppamento: fine metodo");

		return documentoXML;
	}
	
	/* 
	 * 
	 */
	@Override
	public String getTipiRegimeFiscale() {
		LOG.debug("getTipiRegimeFiscale: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("G_070");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("getTipiRegimeFiscale: fine metodo");

		return documentoXML;
	}
	
	@Override
	public String getNazioni() {
		LOG.debug("getNazioni: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager.getNazioniCodificate();
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);

		LOG.debug("getNazioni: fine metodo");

		return documentoXML;
	}

	@Override
	public it.maggioli.eldasoft.sil.gare.ws.CheckDocumentiNulliOutType checkDocumentiNulli(
			String codiceGara, String username, String tipoBusta) {
		LOG.debug("checkDocumentiNulli(): inizio metodo");

		CheckDocumentiNulliOutType risultato = new CheckDocumentiNulliOutType();
		try {
			List<DocumentoAllegatoLotto> res = this.bandiManager
				.checkDocumentiNulli(codiceGara, username, tipoBusta);
			risultato.setRisultato(res);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("checkDocumentiNulli: fine metodo");
		return risultato;		
	}

	@Override
	public it.maggioli.eldasoft.sil.gare.ws.CheckDimensioneDocumentiOutType checkDimensioneDocumenti(
			String codiceGara, String username, String tipoBusta) {
		LOG.debug("checkDimensioneDocumenti(): inizio metodo");

		CheckDimensioneDocumentiOutType risultato = new CheckDimensioneDocumentiOutType();
		try {
			List<DocumentoAllegatoLotto> res = this.bandiManager
				.checkDimensioneDocumenti(codiceGara, username, tipoBusta);
			risultato.setRisultato(res);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		} 
		
		LOG.debug("checkDimensioneDocumenti: fine metodo");
		return risultato;
	}
	
	@Override
	public DelibereOutType getDelibere(
			Integer annoInizio,  
			String stazioneAppaltante, 
			String oggetto, 
			String tipoAppalto, 
			String cig, 
			Date dataPubblicazioneDa, 
			Date dataPubblicazioneA,
			Boolean sommaUrgenza,
			int indicePrimoRecord, int maxNumRecord) 
	{
		LOG.debug("getDelibere("
				+ (annoInizio != null ? annoInizio : "") + ","
				+ stazioneAppaltante + "," + oggetto + ","	+ tipoAppalto + "," + cig + ","
				+ (dataPubblicazioneDa != null ? dataPubblicazioneDa : "") + ","
				+ (dataPubblicazioneA != null ? dataPubblicazioneA : "") + ","
				+ sommaUrgenza + ","
				+ indicePrimoRecord + "," + maxNumRecord + ","
				+ "): inizio metodo");

		DelibereOutType risultato = new DelibereOutType();

		try {
			risultato.setNumElementiTotali(this.bandiManager.countDelibere(
					annoInizio, 
					stazioneAppaltante, 
					oggetto, 
					tipoAppalto, 
					cig, 
					dataPubblicazioneDa, 
					dataPubblicazioneA,
					sommaUrgenza));
			
			if (risultato.getNumElementiTotali() > 0) {
				List<DeliberaType> delibere = this.bandiManager.getDelibere(
						annoInizio, 
						stazioneAppaltante, 
						oggetto, 
						tipoAppalto, 
						cig, 
						dataPubblicazioneDa, 
						dataPubblicazioneA,
						sommaUrgenza, 
						indicePrimoRecord, maxNumRecord);
				risultato.setDelibere(delibere);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati",
					  e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("getDelibere: fine metodo");

		return risultato;
	}

	@Override
	public SommaUrgenzaOutType getElencoSommaUrgenza(
			String stazioneAppaltante, 
			String oggetto, 
			String tipoAppalto,
			String cig,
			Date dataPubblicazioneDa, 
			Date dataPubblicazioneA,
			int indicePrimoRecord, int maxNumRecord) {
		LOG.debug("getElencoSommaUrgenza("
				+ stazioneAppaltante + "," + oggetto + ","	+ tipoAppalto + "," + cig + ","
				+ (dataPubblicazioneDa != null ? dataPubblicazioneDa : "") + ","
				+ (dataPubblicazioneA != null ? dataPubblicazioneA : "") + ","
				+ indicePrimoRecord + "," + maxNumRecord + ","
				+ "): inizio metodo");

		SommaUrgenzaOutType risultato = new SommaUrgenzaOutType();

		try {
			risultato.setNumElementiTotali(this.bandiManager.countElencoSommaUrgenza(
					stazioneAppaltante, 
					oggetto, 
					tipoAppalto, 
					cig, 
					dataPubblicazioneDa, 
					dataPubblicazioneA));
			
			if (risultato.getNumElementiTotali() > 0) {
				List<SommaUrgenzaType> lista = this.bandiManager.getElencoSommaUrgenza(
						stazioneAppaltante, 
						oggetto, 
						tipoAppalto,
						cig,
						dataPubblicazioneDa, 
						dataPubblicazioneA,
						indicePrimoRecord,
						maxNumRecord);
				risultato.setSommaUrgenza(lista);
			}
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati",
					  e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("getElencoSommaUrgenza: fine metodo");

		return risultato;
	}

	
	@Override
	public WSDMConfigOutType getWSDMConfig(
			String stazioneAppaltante) {
		LOG.debug("getWSDMConfig("
				+ stazioneAppaltante
				+ "): inizio metodo");

		WSDMConfigOutType risultato = new WSDMConfigOutType();

		try {
			List<WSDMConfigType> wsdmconfig = this.bandiManager.getWSDMConfig(
						stazioneAppaltante);
			risultato.setWSDMConfig(wsdmconfig);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati",
					  e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("getWSDMConfig: fine metodo");

		return risultato;
	}

	@Override
	public String getIdImpresa(String username) {
		LOG.debug("getIdImpresa: inizio metodo");

		String codice = this.impreseGaraManager.getIdImpresa(username);
		
		LOG.debug("getIdImpresa: fine metodo");

		return codice;
	}

	@Override
	public InvitiGaraOutType getElencoInvitiGara(
			String username, String codice) {
		LOG.debug("getElencoInvitiGara("
				+ username + "," + codice
				+ "): inizio metodo");

		InvitiGaraOutType risultato = new InvitiGaraOutType();

		try {
			List<InvitoGaraType> inviti = this.bandiManager.getElencoInvitiGara(username, codice);
			risultato.setElencoInvitiGara(inviti);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati",
					  e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("getElencoInvitiGara: fine metodo");

		return risultato;
	}

	@Override
	public RisultatoNumericoOutType getNumeroOrdineInvito(
			String username, String codice) {
		LOG.debug("getNumeroOrdineInvito(" + username + ", "
				+ codice
				+ "): inizio metodo");

		RisultatoNumericoOutType risultato = new RisultatoNumericoOutType();
		try {
			Long numOrdine = this.bandiManager.getNumeroOrdineInvito(username, codice);
			risultato.setValore(numOrdine);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati",
					  e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("getNumeroOrdineInvito: fine metodo");

		return risultato;

	}

	@Override
	public QuestionarioOutType getQuestionari(
			String codice, 
			String tipologia, 
			String busta) {
		LOG.debug("getQuestionari("
				+ codice + "," + tipologia + "," + busta
				+ "): inizio metodo");

		QuestionarioOutType risultato = new QuestionarioOutType();
		try {
			List<QuestionarioType> questionari = this.bandiManager.getQuestionari(codice, tipologia, busta);
			risultato.setQuestionari(questionari);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati",
					  e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("getQuestionari: fine metodo");

		return risultato;
	}

	@Override
	public ParametriQuestionarioOutType getParametriQuestionario() {
		LOG.debug("getParametriQuestionario(" + "): inizio metodo");

		ParametriQuestionarioOutType risultato = new ParametriQuestionarioOutType();
		try {
			List<ParametroQuestionarioType> parametri = this.bandiManager.getParametriQuestionario();
			
			// valorizzazione dei paraemtri...
			//tipoOperatore = TIPIMP.IMPR
			//nazioneOperatore = NAZIMP.IMPR (oppure una mappatura nei due valori 'italiano/estero')
			//ragioneSocialeOperatore = NOMEST.IMPR
			//indirizzoOperatore = INDIMP.IMPR + ....
			//iscrittoCCIAA = ISCRCCIAA.IMPR
			
			risultato.setParametri(parametri);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati",
					  e);
			risultato.setErrore(e.getMessage());
		} catch (SqlComposerException e) {
			LOG.error("DBMS non supportato o non valido", e);
			risultato.setErrore("DBMS non supportato o non valido");
		}

		LOG.debug("getParametriQuestionario: fine metodo");

		return risultato;
	}
	
	@Override
	public String getElencoFasiStipula() {
		LOG.debug("getElencoFasiStipula: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A1181");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);
		
		LOG.debug("getElencoAltriSoggetti: fine metodo");

		return documentoXML;
	}

	@Override
	public String getElencoStatiStipula() {
		LOG.debug("getElencoStatiStipula: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A1185");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);
		
		LOG.debug("getElencoStatiStipula: fine metodo");

		return documentoXML;
	}

	@Override
	public String getTipologiaProdotto() {
		LOG.debug("getTipologiaProdotto: inizio metodo");

		List<DatoCodificatoType> lista = this.datiCodificatiManager
				.getTipiTab1("A1192");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(lista);
		
		LOG.debug("getTipologiaProdotto: fine metodo");

		return documentoXML;
	}

	/**
	 * recupera se la gestione del gruppo IVA e' abilitata o meno
	 */
	@Override
	public GetCfgCheckParametroOutType getCfgCheckGruppoIvaAbilitato() {
		LOG.debug("getCfgCheckGruppoIvaAbilitato(): inizio metodo");
		GetCfgCheckParametroOutType risultato = new GetCfgCheckParametroOutType();
		try {
			List<DatoCodificatoType> lista = this.datiCodificatiManager
					.getTipiTab1("G_072");
			boolean checkGruppoIva = false;
			for (int i = 0; i < lista.size(); i++) {
				DatoCodificatoType configurazione = lista.get(i);
				if (configurazione.getDescrizione() != null
						&& configurazione.getDescrizione().startsWith("1")) {
					checkGruppoIva = true;
					break;
				}
			}
			risultato.setCheckAbilitato(checkGruppoIva);
		} catch (DataAccessException e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}
		LOG.debug("getCfgCheckGruppoIvaAbilitato: fine metodo");
		return risultato;
	}

	@Override
	public String getTipiAmmissioneProcedura() {
		LOG.debug("getTipiAmmissioneProcedura: inizio metodo");

		List<DatoCodificatoType> listaTipi = this.datiCodificatiManager
				.getTipiTab1("A1170");
		String documentoXML = WSOperazioniGeneraliSoapImpl.buildXML(listaTipi);

		LOG.debug("getTipiAmmissioneProcedura: fine metodo");
		
		return documentoXML;
	}

	@Override
	public GetVendorRatingOutType getVendorRating(String tokenRichiedente, Date data) {
		LOG.debug("getVendorRating({};{}): inizio metodo"
				, tokenRichiedente, data);
		GetVendorRatingOutType risultato = new GetVendorRatingOutType();
		try {
			VendorRatingType vendorRating = impreseGaraManager.getVendorRating(tokenRichiedente, data);
			risultato.setVendorRatingType(vendorRating);
		} catch (Exception e) {
			LOG.error("Errore inaspettato durante l'interazione con la base dati", e);
			risultato.setErrore(e.getMessage());
		}

		LOG.debug("getVendorRating: fine metodo");

		return risultato;
	}

}